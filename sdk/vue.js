var oe=Object.create;var F=Object.defineProperty;var ne=Object.getOwnPropertyDescriptor;var re=Object.getOwnPropertyNames;var se=Object.getPrototypeOf,ie=Object.prototype.hasOwnProperty;var ae=(d,w)=>()=>(w||d((w={exports:{}}).exports,w),w.exports);var le=(d,w,C,b)=>{if(w&&typeof w=="object"||typeof w=="function")for(let y of re(w))!ie.call(d,y)&&y!==C&&F(d,y,{get:()=>w[y],enumerable:!(b=ne(w,y))||b.enumerable});return d};var ce=(d,w,C)=>(C=d!=null?oe(se(d)):{},le(w||!d||!d.__esModule?F(C,"default",{value:d,enumerable:!0}):C,d));var X=ae((ve,_)=>{var de=function(){var d=String.fromCharCode,w="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",C="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$",b={};function y(t,r){if(!b[t]){b[t]={};for(var f=0;f<t.length;f++)b[t][t.charAt(f)]=f}return b[t][r]}var O={compressToBase64:function(t){if(t==null)return"";var r=O._compress(t,6,function(f){return w.charAt(f)});switch(r.length%4){default:case 0:return r;case 1:return r+"===";case 2:return r+"==";case 3:return r+"="}},decompressFromBase64:function(t){return t==null?"":t==""?null:O._decompress(t.length,32,function(r){return y(w,t.charAt(r))})},compressToUTF16:function(t){return t==null?"":O._compress(t,15,function(r){return d(r+32)})+" "},decompressFromUTF16:function(t){return t==null?"":t==""?null:O._decompress(t.length,16384,function(r){return t.charCodeAt(r)-32})},compressToUint8Array:function(t){for(var r=O.compress(t),f=new Uint8Array(r.length*2),n=0,i=r.length;n<i;n++){var p=r.charCodeAt(n);f[n*2]=p>>>8,f[n*2+1]=p%256}return f},decompressFromUint8Array:function(t){if(t==null)return O.decompress(t);for(var r=new Array(t.length/2),f=0,n=r.length;f<n;f++)r[f]=t[f*2]*256+t[f*2+1];var i=[];return r.forEach(function(p){i.push(d(p))}),O.decompress(i.join(""))},compressToEncodedURIComponent:function(t){return t==null?"":O._compress(t,6,function(r){return C.charAt(r)})},decompressFromEncodedURIComponent:function(t){return t==null?"":t==""?null:(t=t.replace(/ /g,"+"),O._decompress(t.length,32,function(r){return y(C,t.charAt(r))}))},compress:function(t){return O._compress(t,16,function(r){return d(r)})},_compress:function(t,r,f){if(t==null)return"";var n,i,p={},a={},m="",P="",h="",E=2,L=3,l=2,u=[],o=0,e=0,S;for(S=0;S<t.length;S+=1)if(m=t.charAt(S),Object.prototype.hasOwnProperty.call(p,m)||(p[m]=L++,a[m]=!0),P=h+m,Object.prototype.hasOwnProperty.call(p,P))h=P;else{if(Object.prototype.hasOwnProperty.call(a,h)){if(h.charCodeAt(0)<256){for(n=0;n<l;n++)o=o<<1,e==r-1?(e=0,u.push(f(o)),o=0):e++;for(i=h.charCodeAt(0),n=0;n<8;n++)o=o<<1|i&1,e==r-1?(e=0,u.push(f(o)),o=0):e++,i=i>>1}else{for(i=1,n=0;n<l;n++)o=o<<1|i,e==r-1?(e=0,u.push(f(o)),o=0):e++,i=0;for(i=h.charCodeAt(0),n=0;n<16;n++)o=o<<1|i&1,e==r-1?(e=0,u.push(f(o)),o=0):e++,i=i>>1}E--,E==0&&(E=Math.pow(2,l),l++),delete a[h]}else for(i=p[h],n=0;n<l;n++)o=o<<1|i&1,e==r-1?(e=0,u.push(f(o)),o=0):e++,i=i>>1;E--,E==0&&(E=Math.pow(2,l),l++),p[P]=L++,h=String(m)}if(h!==""){if(Object.prototype.hasOwnProperty.call(a,h)){if(h.charCodeAt(0)<256){for(n=0;n<l;n++)o=o<<1,e==r-1?(e=0,u.push(f(o)),o=0):e++;for(i=h.charCodeAt(0),n=0;n<8;n++)o=o<<1|i&1,e==r-1?(e=0,u.push(f(o)),o=0):e++,i=i>>1}else{for(i=1,n=0;n<l;n++)o=o<<1|i,e==r-1?(e=0,u.push(f(o)),o=0):e++,i=0;for(i=h.charCodeAt(0),n=0;n<16;n++)o=o<<1|i&1,e==r-1?(e=0,u.push(f(o)),o=0):e++,i=i>>1}E--,E==0&&(E=Math.pow(2,l),l++),delete a[h]}else for(i=p[h],n=0;n<l;n++)o=o<<1|i&1,e==r-1?(e=0,u.push(f(o)),o=0):e++,i=i>>1;E--,E==0&&(E=Math.pow(2,l),l++)}for(i=2,n=0;n<l;n++)o=o<<1|i&1,e==r-1?(e=0,u.push(f(o)),o=0):e++,i=i>>1;for(;;)if(o=o<<1,e==r-1){u.push(f(o));break}else e++;return u.join("")},decompress:function(t){return t==null?"":t==""?null:O._decompress(t.length,32768,function(r){return t.charCodeAt(r)})},_decompress:function(t,r,f){var n=[],i,p=4,a=4,m=3,P="",h=[],E,L,l,u,o,e,S,c={val:f(0),position:r,index:1};for(E=0;E<3;E+=1)n[E]=E;for(l=0,o=Math.pow(2,2),e=1;e!=o;)u=c.val&c.position,c.position>>=1,c.position==0&&(c.position=r,c.val=f(c.index++)),l|=(u>0?1:0)*e,e<<=1;switch(i=l){case 0:for(l=0,o=Math.pow(2,8),e=1;e!=o;)u=c.val&c.position,c.position>>=1,c.position==0&&(c.position=r,c.val=f(c.index++)),l|=(u>0?1:0)*e,e<<=1;S=d(l);break;case 1:for(l=0,o=Math.pow(2,16),e=1;e!=o;)u=c.val&c.position,c.position>>=1,c.position==0&&(c.position=r,c.val=f(c.index++)),l|=(u>0?1:0)*e,e<<=1;S=d(l);break;case 2:return""}for(n[3]=S,L=S,h.push(S);;){if(c.index>t)return"";for(l=0,o=Math.pow(2,m),e=1;e!=o;)u=c.val&c.position,c.position>>=1,c.position==0&&(c.position=r,c.val=f(c.index++)),l|=(u>0?1:0)*e,e<<=1;switch(S=l){case 0:for(l=0,o=Math.pow(2,8),e=1;e!=o;)u=c.val&c.position,c.position>>=1,c.position==0&&(c.position=r,c.val=f(c.index++)),l|=(u>0?1:0)*e,e<<=1;n[a++]=d(l),S=a-1,p--;break;case 1:for(l=0,o=Math.pow(2,16),e=1;e!=o;)u=c.val&c.position,c.position>>=1,c.position==0&&(c.position=r,c.val=f(c.index++)),l|=(u>0?1:0)*e,e<<=1;n[a++]=d(l),S=a-1,p--;break;case 2:return h.join("")}if(p==0&&(p=Math.pow(2,m),m++),n[S])P=n[S];else if(S===a)P=L+L.charAt(0);else return null;h.push(P),n[a++]=L+P.charAt(0),p--,L=P,p==0&&(p=Math.pow(2,m),m++)}}};return O}();typeof _!="undefined"&&_!=null&&(_.exports=de)});import{h as fe,onMounted as pe,onUnmounted as ue,ref as I,watch as ye}from"vue";var V=ce(X());async function H(d,w={}){typeof d=="object"&&!(d instanceof HTMLElement)&&d.view==="headless"&&(w=d,d=null);let{appUrl:C="https://livecodes.io/",params:b={},config:y={},import:O,headless:t,lite:r,loading:f="lazy",template:n,view:i}=w,p=t||i==="headless",a=null;if(typeof d=="string")a=document.querySelector(d);else if(d instanceof HTMLElement)a=d;else if(!(p&&typeof d=="object"))throw new Error("A valid container element is required.");if(!a)if(p)a=document.createElement("div"),z(a),document.body.appendChild(a);else throw new Error(`Cannot find element: "${d}"`);let m;try{m=new URL(C)}catch(s){throw new Error(`"${C}" is not a valid URL.`)}let P=m.origin;if(b&&typeof b=="object")try{m.searchParams.set("params",(0,V.compressToEncodedURIComponent)(JSON.stringify(b)))}catch(s){Object.keys(b).forEach(v=>{m.searchParams.set(v,encodeURIComponent(String(b[v])))})}if(n&&m.searchParams.set("template",n),O&&m.searchParams.set("x",encodeURIComponent(O)),p&&m.searchParams.set("headless","true"),r&&(console.warn(`Deprecation notice: "lite" option is deprecated. Use "config: { mode: 'lite' }" instead.`),typeof y=="object"&&y.mode==null?y.mode="lite":m.searchParams.set("lite","true")),i&&(console.warn('Deprecation notice: The "view" option has been moved to "config.view". For headless mode use "headless: true".'),typeof y=="object"&&y.view==null&&i!=="headless"?y.view=i:m.searchParams.set("view",i)),typeof y=="string")try{new URL(y),m.searchParams.set("config",encodeURIComponent(y))}catch(s){throw new Error('"config" is not a valid URL or configuration object.')}else if(typeof y=="object")Object.keys(y).length>0&&m.searchParams.set("config","sdk");else throw new Error('"config" is not a valid URL or configuration object.');m.searchParams.set("embed","true"),m.searchParams.set("loading",p?"eager":f);let h=!1,E="Cannot call API methods after calling `destroy()`.",l=await new Promise(s=>{var T,M,k,j,U,W,q,Q,Z;if(!a)return;let v=a.dataset.height||a.style.height;if(v&&!p){let N=isNaN(Number(v))?v:v+"px";a.style.height=N}a.dataset.defaultStyles!=="false"&&!p&&((T=a.style).backgroundColor||(T.backgroundColor="#fff"),(M=a.style).border||(M.border="1px solid black"),(k=a.style).borderRadius||(k.borderRadius="8px"),(j=a.style).boxSizing||(j.boxSizing="border-box"),(U=a.style).padding||(U.padding="0"),(W=a.style).width||(W.width="100%"),(q=a.style).height||(q.height=a.style.height||"300px"),a.style.minHeight="200px",a.style.flexGrow="1",(Q=a.style).overflow||(Q.overflow="hidden"),(Z=a.style).resize||(Z.resize="vertical"));let x="livecodes",A=a.querySelector(`iframe.${x}`),g=A||document.createElement("iframe");g.classList.add(x),g.setAttribute("allow","accelerometer; camera; encrypted-media; display-capture; geolocation; gyroscope; microphone; midi; clipboard-read; clipboard-write; web-share"),g.setAttribute("allowtransparency","true"),g.setAttribute("allowpaymentrequest","true"),g.setAttribute("allowfullscreen","true"),g.setAttribute("sandbox","allow-same-origin allow-downloads allow-forms allow-modals allow-orientation-lock allow-pointer-lock allow-popups allow-presentation allow-scripts");let R=f==="eager"?"eager":"lazy";g.setAttribute("loading",R),p?z(g):(g.style.height="100%",g.style.minHeight="200px",g.style.width="100%",g.style.margin="0",g.style.border="0",g.style.borderRadius=a.style.borderRadius),addEventListener("message",function N(D){var $,G;D.source!==g.contentWindow||D.origin!==P||(($=D.data)==null?void 0:$.type)!=="livecodes-get-config"||(removeEventListener("message",N),(G=g.contentWindow)==null||G.postMessage({type:"livecodes-config",payload:y},P))}),g.onload=()=>{s(g)},g.src=m.href,A||a.appendChild(g)}),u=new Promise(s=>{addEventListener("message",function v(x){var A;x.source!==l.contentWindow||x.origin!==P||((A=x.data)==null?void 0:A.type)!=="livecodes-ready"||(removeEventListener("message",v),s(),u.settled=!0)})}),o=()=>h?Promise.reject(E):new Promise(async s=>{var x;u.settled&&s();let v={type:"livecodes-load"};(x=l.contentWindow)==null||x.postMessage(v,P),await u,s()}),e=(s,v)=>new Promise(async(x,A)=>{var R;if(h)return A(E);await o();let g=te();addEventListener("message",function T(M){var k,j;if(!(M.source!==l.contentWindow||M.origin!==P||((k=M.data)==null?void 0:k.type)!=="livecodes-api-response"||((j=M.data)==null?void 0:j.id)!==g)&&M.data.method===s){removeEventListener("message",T);let U=M.data.payload;U!=null&&U.error?A(U.error):x(U)}}),(R=l.contentWindow)==null||R.postMessage({method:s,id:g,args:v},P)}),S={},c=["load","ready","code","console","tests","destroy"],K=(s,v)=>{var x;if(h)throw new Error(E);return c.includes(s)?(e("watch",[s]),S[s]||(S[s]=[]),(x=S[s])==null||x.push(v),{remove:()=>{var A,g;S[s]=(A=S[s])==null?void 0:A.filter(R=>R!==v),((g=S[s])==null?void 0:g.length)===0&&e("watch",[s,"unsubscribe"])}}):{remove:()=>{}}},ee=s=>({"livecodes-app-loaded":"load","livecodes-ready":"ready","livecodes-change":"code","livecodes-console":"console","livecodes-test-results":"tests","livecodes-destroy":"destroy"})[s];addEventListener("message",async s=>{var A,g,R,T;let v=ee((g=(A=s.data)==null?void 0:A.type)!=null?g:"");if(s.source!==l.contentWindow||s.origin!==P||!v||!S[v])return;let x=(R=s.data)==null?void 0:R.payload;(T=S[v])==null||T.forEach(M=>{M(x)})});let B=()=>{var s;Object.values(S).forEach(v=>{v.length=0}),(s=l==null?void 0:l.remove)==null||s.call(l),h=!0};f==="lazy"&&"IntersectionObserver"in window&&new IntersectionObserver((v,x)=>{v.forEach(async A=>{A.isIntersecting&&(await o(),x.unobserve(a))})},{rootMargin:"150px"}).observe(a);function z(s){s.style.position="absolute",s.style.top="0",s.style.visibility="hidden",s.style.opacity="0"}let te=()=>(String(Math.random())+Date.now().toFixed()).replace("0.","");return{load:()=>o(),run:()=>e("run"),format:s=>e("format",[s]),getShareUrl:s=>e("getShareUrl",[s]),getConfig:s=>e("getConfig",[s]),setConfig:s=>e("setConfig",[s]),getCode:()=>e("getCode"),show:(s,v)=>e("show",[s,v]),runTests:()=>e("runTests"),onChange:s=>K("code",s),watch:K,exec:(s,...v)=>e("exec",[s,...v]),destroy:()=>u.settled?e("destroy").then(B):h?Promise.reject(E):(B(),Promise.resolve())}}var Y;globalThis.document&&document.currentScript&&"prefill"in((Y=document.currentScript)==null?void 0:Y.dataset)&&window.addEventListener("load",()=>{document.querySelectorAll(".livecodes").forEach(d=>{let w,C=d.dataset.options;if(C)try{w=JSON.parse(C)}catch(t){}let b,y=d.dataset.config||d.dataset.prefill;if(y)try{b=JSON.parse(y)}catch(t){}let O=encodeURIComponent(d.outerHTML);d.innerHTML="",H(d,{import:"dom/"+O,...w,...b?{config:b}:{}})})});var me={appUrl:String,config:[Object,String],headless:Boolean,import:String,lite:Boolean,loading:String,params:Object,template:String,view:String,height:String},J=d=>JSON.parse(JSON.stringify(d)),he={props:me,emits:["sdkReady"],setup(d,w){let{height:C,...b}=d,y=I(),O=I(C||""),t=I(),{config:r,...f}=b,n=JSON.stringify(r),i=JSON.stringify(f);return pe(()=>{y.value&&H(y.value,J(b)).then(p=>{t.value=p,w.emit("sdkReady",p)})}),ye(d,async p=>{var E;if(!y.value||!t.value)return;let{height:a,...m}=p;O.value=a||"";let{config:P,...h}=m;typeof P=="string"&&(P=await fetch(P).then(L=>L.json())),JSON.stringify(h)!==i?(await((E=t.value)==null?void 0:E.destroy()),H(y.value,J(m)).then(L=>{t.value=L,w.emit("sdkReady",L)})):JSON.stringify(P)!==n&&t.value.setConfig(J(P)||{}),n=JSON.stringify(P),i=JSON.stringify(h)}),ue(()=>{var p;(p=t.value)==null||p.destroy()}),()=>{var p,a;return fe("div",{ref:y,"data-height":O},((a=(p=w.slots).default)==null?void 0:a.call(p))||"")}}},Pe=he;export{Pe as default};
