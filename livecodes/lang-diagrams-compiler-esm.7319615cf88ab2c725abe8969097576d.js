var lt=typeof atob=="function",pt=typeof btoa=="function",U=typeof Buffer=="function",q=typeof TextDecoder=="function"?new TextDecoder:void 0,R=typeof TextEncoder=="function"?new TextEncoder:void 0,dt="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",k=Array.prototype.slice.call(dt),S=(t=>{let e={};return t.forEach((r,o)=>e[r]=o),e})(k),mt=/^(?:[A-Za-z\d+\/]{4})*?(?:[A-Za-z\d+\/]{2}(?:==)?|[A-Za-z\d+\/]{3}=?)?$/,p=String.fromCharCode.bind(String),P=typeof Uint8Array.from=="function"?Uint8Array.from.bind(Uint8Array):t=>new Uint8Array(Array.prototype.slice.call(t,0)),ut=t=>t.replace(/=/g,"").replace(/[+\/]/g,e=>e=="+"?"-":"_"),H=t=>t.replace(/[^A-Za-z0-9\+\/]/g,""),gt=t=>{let e,r,o,n,s="",i=t.length%3;for(let c=0;c<t.length;){if((r=t.charCodeAt(c++))>255||(o=t.charCodeAt(c++))>255||(n=t.charCodeAt(c++))>255)throw new TypeError("invalid character found");e=r<<16|o<<8|n,s+=k[e>>18&63]+k[e>>12&63]+k[e>>6&63]+k[e&63]}return i?s.slice(0,i-3)+"===".substring(i):s},F=pt?t=>btoa(t):U?t=>Buffer.from(t,"binary").toString("base64"):gt,ft=U?t=>Buffer.from(t).toString("base64"):t=>{let r=[];for(let o=0,n=t.length;o<n;o+=4096)r.push(p.apply(null,t.subarray(o,o+4096)));return F(r.join(""))};var ht=t=>{if(t.length<2){var e=t.charCodeAt(0);return e<128?t:e<2048?p(192|e>>>6)+p(128|e&63):p(224|e>>>12&15)+p(128|e>>>6&63)+p(128|e&63)}else{var e=65536+(t.charCodeAt(0)-55296)*1024+(t.charCodeAt(1)-56320);return p(240|e>>>18&7)+p(128|e>>>12&63)+p(128|e>>>6&63)+p(128|e&63)}},xt=/[\uD800-\uDBFF][\uDC00-\uDFFFF]|[^\x00-\x7F]/g,yt=t=>t.replace(xt,ht),N=U?t=>Buffer.from(t,"utf8").toString("base64"):R?t=>ft(R.encode(t)):t=>F(yt(t)),_=(t,e=!1)=>e?ut(N(t)):N(t);var bt=/[\xC0-\xDF][\x80-\xBF]|[\xE0-\xEF][\x80-\xBF]{2}|[\xF0-\xF7][\x80-\xBF]{3}/g,wt=t=>{switch(t.length){case 4:var e=(7&t.charCodeAt(0))<<18|(63&t.charCodeAt(1))<<12|(63&t.charCodeAt(2))<<6|63&t.charCodeAt(3),r=e-65536;return p((r>>>10)+55296)+p((r&1023)+56320);case 3:return p((15&t.charCodeAt(0))<<12|(63&t.charCodeAt(1))<<6|63&t.charCodeAt(2));default:return p((31&t.charCodeAt(0))<<6|63&t.charCodeAt(1))}},vt=t=>t.replace(bt,wt),Ut=t=>{if(t=t.replace(/\s+/g,""),!mt.test(t))throw new TypeError("malformed base64.");t+="==".slice(2-(t.length&3));let e,r="",o,n;for(let s=0;s<t.length;)e=S[t.charAt(s++)]<<18|S[t.charAt(s++)]<<12|(o=S[t.charAt(s++)])<<6|(n=S[t.charAt(s++)]),r+=o===64?p(e>>16&255):n===64?p(e>>16&255,e>>8&255):p(e>>16&255,e>>8&255,e&255);return r},W=lt?t=>atob(H(t)):U?t=>Buffer.from(t,"base64").toString("binary"):Ut,jt=U?t=>P(Buffer.from(t,"base64")):t=>P(W(t).split("").map(e=>e.charCodeAt(0)));var Ct=U?t=>Buffer.from(t,"base64").toString("utf8"):q?t=>q.decode(jt(t)):t=>vt(W(t)),kt=t=>H(t.replace(/[-_]/g,e=>e=="-"?"+":"/")),O=t=>Ct(kt(t));var z=t=>t.replace(/'[^'"]*'(?=(?:[^"]*"[^"]*")*[^"]*$)/g,function(r){return'"'+r.substring(1,r.length-1)+'"'}).replace(/(\w+(?=([^"\\]*(\\.|"([^"\\]*\\.)*[^"\\]*"))*[^"]*$))(\s*:)(?!(\w*)(?:"))/gm,function(r){return'"'+r.substring(0,r.length-1).trimEnd()+'":'}).replace(/,\s*([\]}])/g,"$1");var d=(t,e)=>new Promise((r,o)=>{if(e&&globalThis[e])return r(globalThis[e]);if(typeof globalThis.importScripts=="function")return globalThis.importScripts(t),e&&globalThis[e]?r(globalThis[e]):r(globalThis);let n=document.createElement("script");n.src=t,n.async=!0;let s=()=>{n.removeEventListener("load",i),n.removeEventListener("error",c)},i=()=>{if(s(),!e)return r("loaded: "+t);let l=setInterval(()=>{if(window[e])return clearInterval(l),r(window[e])},5)},c=()=>{s(),o("failed to load: "+t)};n.addEventListener("load",i),n.addEventListener("error",c),document.head.appendChild(n)});var I=t=>new Promise((e,r)=>{let o=new FileReader;o.readAsDataURL(t),o.onload=()=>typeof o.result=="string"?e(o.result):r(),o.onerror=n=>r(n)});var E=(t,e="text/javascript")=>`data:${e};charset=UTF-8;base64,`+_(t),A=t=>E(`importScripts("${t}");`);var B=t=>t.replace(/\/\*[\s\S]*?\*\/|([^\\:]|^)\/\/.*$/gm,"$1");var V=(t,e)=>({...e.customSettings[t]});var J=(t,e)=>async r=>{try{return await t(r)}catch(o){return typeof e=="function"&&e(o),r}};var Z=["esm.sh","skypack","jspm"],G=["unpkg","jsdelivr","fastly.jsdelivr"],Q=["fastly.jsdelivr.gh","jsdelivr.gh","statically"],w={getModuleUrl:(t,{isModule:e=!0,defaultCDN:r="esm.sh"}={})=>{t=t.replace(/#nobundle/g,"");let o=K(t,e,r);return o||(e?"https://esm.sh/"+t:"https://cdn.jsdelivr.net/npm/"+t)},getUrl:(t,e)=>t.startsWith("http")||t.startsWith("data:")?t:K(t,!1,e||St())||t,cdnLists:{npm:G,module:Z,gh:Q},checkCDNs:async(t,e)=>{let r=[e,...w.cdnLists.npm].filter(Boolean);for(let o of r)try{if((await fetch(w.getUrl(t,o),{method:"HEAD"})).ok)return o}catch{}return w.cdnLists.npm[0]}},St=()=>{if(globalThis.appCDN)return globalThis.appCDN;try{return new URL(location.href).searchParams.get("appCDN")||w.cdnLists.npm[0]}catch{return w.cdnLists.npm[0]}},K=(t,e,r)=>{let o=e&&t.startsWith("unpkg:")?"?module":"";t.startsWith("gh:")?t=t.replace("gh",Q[0]):t.includes(":")||(t=(r||(e?Z[0]:G[0]))+":"+t);for(let n of Lt){let[s,i]=n;if(s.test(t))return t.replace(s,i)+o}return null},Lt=[[/^(jspm:)(.+)/i,"https://jspm.dev/$2"],[/^(npm:)(.+)/i,"https://esm.sh/$2"],[/^(node:)(.+)/i,"https://esm.sh/$2"],[/^(skypack:)(.+)/i,"https://cdn.skypack.dev/$2"],[/^(jsdelivr:)(.+)/i,"https://cdn.jsdelivr.net/npm/$2"],[/^(fastly.jsdelivr:)(.+)/i,"https://fastly.jsdelivr.net/npm/$2"],[/^(jsdelivr.gh:)(.+)/i,"https://cdn.jsdelivr.net/gh/$2"],[/^(fastly.jsdelivr.gh:)(.+)/i,"https://fastly.jsdelivr.net/gh/$2"],[/^(statically:)(.+)/i,"https://cdn.statically.io/gh/$2"],[/^(esm.run:)(.+)/i,"https://esm.run/$2"],[/^(esm.sh:)(.+)/i,"https://esm.sh/$2"],[/^(esbuild:)(.+)/i,"https://esbuild.vercel.app/$2"],[/^(bundle.run:)(.+)/i,"https://bundle.run/$2"],[/^(unpkg:)(.+)/i,"https://unpkg.com/$2"],[/^(bundlejs:)(.+)/i,"https://deno.bundlejs.com/?file&q=$2"],[/^(bundle:)(.+)/i,"https://deno.bundlejs.com/?file&q=$2"],[/^(deno:)(.+)/i,"https://deno.bundlejs.com/?file&q=https://deno.land/x/$2/mod.ts"],[/^(https:\/\/deno\.land\/.+)/i,"https://deno.bundlejs.com/?file&q=$1"],[/^(github:|https:\/\/github\.com\/)(.[^\/]+?)\/(.[^\/]+?)\/(?!releases\/)(?:(?:blob|raw)\/)?(.+?\/.+)/i,"https://deno.bundlejs.com/?file&q=https://cdn.jsdelivr.net/gh/$2/$3@$4"],[/^(gist\.github:)(.+?\/[0-9a-f]+\/raw\/(?:[0-9a-f]+\/)?.+)$/i,"https://gist.githack.com/$2"],[/^(gitlab:|https:\/\/gitlab\.com\/)([^\/]+.*\/[^\/]+)\/(?:raw|blob)\/(.+?)(?:\?.*)?$/i,"https://deno.bundlejs.com/?file&q=https://gl.githack.com/$2/raw/$3"],[/^(bitbucket:|https:\/\/bitbucket\.org\/)([^\/]+\/[^\/]+)\/(?:raw|src)\/(.+?)(?:\?.*)?$/i,"https://deno.bundlejs.com/?file&q=https://bb.githack.com/$2/raw/$3"],[/^(bitbucket:)snippets\/([^\/]+\/[^\/]+)\/revisions\/([^\/\#\?]+)(?:\?[^#]*)?(?:\#file-(.+?))$/i,"https://bb.githack.com/!api/2.0/snippets/$2/$3/files/$4"],[/^(bitbucket:)snippets\/([^\/]+\/[^\/\#\?]+)(?:\?[^#]*)?(?:\#file-(.+?))$/i,"https://bb.githack.com/!api/2.0/snippets/$2/HEAD/files/$3"],[/^(bitbucket:)\!api\/2.0\/snippets\/([^\/]+\/[^\/]+\/[^\/]+)\/files\/(.+?)(?:\?.*)?$/i,"https://bb.githack.com/!api/2.0/snippets/$2/files/$3"],[/^(api\.bitbucket:)2.0\/snippets\/([^\/]+\/[^\/]+\/[^\/]+)\/files\/(.+?)(?:\?.*)?$/i,"https://bb.githack.com/!api/2.0/snippets/$2/files/$3"],[/^(rawgit:)(.+?\/[0-9a-f]+\/raw\/(?:[0-9a-f]+\/)?.+)$/i,"https://gist.githack.com/$2"],[/^(rawgit:|https:\/\/raw\.githubusercontent\.com)(\/[^\/]+\/[^\/]+|[0-9A-Za-z-]+\/[0-9a-f]+\/raw)\/(.+)/i,"https://deno.bundlejs.com/?file&q=https://raw.githack.com/$2/$3"]];var{getUrl:m,getModuleUrl:Jt}=w,L=m("@live-codes/browser-compilers@0.9.0/dist/");var X=m("cytoscape-svg@0.4.0/cytoscape-svg.js"),Y=m("cytoscape@3.25.0/dist/cytoscape.min.js");var M=m("elkjs@0.8.2/lib/");var tt=m("graphre@0.1.3/dist/graphre.js");var et=m("@hpcc-js/wasm@2.13.0/dist/index.js");var Tt="0.6.64",Kt=m(`malinajs@${Tt}/malina.js`);var rt=m("mermaid@10.2.2/dist/mermaid.esm.mjs");var ot=m("nomnoml@1.6.1/dist/nomnoml.js");var st=m("@pintora/standalone@0.6.2/lib/pintora-standalone.umd.js"),nt=m("plotly.js@2.23.2/dist/plotly.js");var it=m("svgbob-wasm@0.4.1-a0/svgbob_wasm_bg.wasm");var D=m("vega@5.25.0/build/vega.js"),at=m("vega-lite@5.9.3/build/vega-lite.js");var $=m("wavedrom@3.2.0/");var ct=!1,Et=(t,e)=>{t.tagName.toLowerCase()==="img"?t.src=E(e,"image/svg+xml"):t.innerHTML=e},j=t=>z(B(t)),h=async(t,e,r,o,n=!1)=>{if(!t)return"";let s=document.createElement("div");s.innerHTML=t;let i=s.querySelectorAll(`script[type="application/diagram-${e}"]`);if(i.length===0)return s.remove(),t;await r();for(let l of i){if(!l.src&&!l.innerHTML.trim())continue;let u=l.dataset.output;if(!u)continue;let b=l.src?await fetch(l.src).then(a=>a.text()):l.innerHTML,x=await o(b,l),C=s.querySelectorAll(`[data-src="${u}"]`);for(let a of C)a.tagName.toLowerCase()!=="img"&&n&&(ct=!0,x=`<svg-container> ${x} </svg-container>`),Et(a,x);l.remove()}let c=s.innerHTML;return s.remove(),c},At=async t=>{let e=document.createElement("div");e.innerHTML=t,document.body.appendChild(e);let r=e.querySelectorAll('script[type="application/diagram-gnuplot"]');if(r.length===0)return e.remove(),t;let o=L+"gnuplot",n=await d(o+"/gnuplot_api.js","Gnuplot"),s=A(o+"/gnuplot.js"),i=window.gnuplot=window.gnuplot||new n(s),c=(a,g)=>new Promise(async y=>{await Promise.all(g.map(v=>new Promise(T=>{i.putFile(v.fileName,v.content,T)}))),i.run(a,y)}),l=a=>new Promise(g=>{i.getFile(a,function(y){if(!y?.content){g("");return}let v=new Uint8Array(y.content),T=new Blob([v],{type:"image/svg+xml"});I(T).then(g)})});await new Promise(a=>i.removeFiles(null,a));let u=[],b=e.querySelectorAll('script[type="application/diagram-gnuplot-file"]');for(let a of b){if(!a.dataset.file&&!a.src)continue;let g=a.src?await fetch(a.src).then(v=>v.text()):a.innerHTML,y=a.dataset.file||a.src?.split("/")[a.src?.split("/").length-1]||"data.txt";u.push({fileName:y,content:g}),a.remove()}for(let a of r){if(!a.src&&!a.innerHTML.trim())continue;let g=a.src?await fetch(a.src).then(y=>y.text()):a.innerHTML;await c(g,u),a.remove()}let x=e.querySelectorAll("[data-src]");for(let a of x){let g=await l(a.dataset.src||"");g&&(a.tagName.toLowerCase()==="img"?a.src=g:a.innerHTML=O(g.split(",")[1]))}let C=e.innerHTML;return e.remove(),C},Bt=async t=>{let e,r=async()=>{e=(await import(rt)).default,e.initialize({startOnLoad:!1})},o=0,n=()=>o++;return h(t,"mermaid",r,async i=>{let c=document.createElement("div");c.id="livecodes-mermaid-chart-"+n(),document.body.appendChild(c);let{svg:l}=await e.render(c.id,i.trim());return c.remove(),l})},Mt=async t=>{let e;return h(t,"graphviz",async()=>{e=await(await import(et)).Graphviz.load()},(n,s)=>{let i=s.dataset.layout||"dot";return e.layout(n,"svg",i)})},Dt=async t=>{let e=document.createElement("div");e.innerHTML=t;let r=e.querySelectorAll('script[type="application/diagram-vega-lite"]'),o;if(r.length>0){o=await d(D,"vega");let c=await d(at,"vegaLite");for(let l of r){if(!l.src&&!l.innerHTML.trim()||!l.dataset.output)continue;let b={};try{let x=l.src?await fetch(l.src).then(C=>C.json()):JSON.parse(j(l.innerHTML));l.innerHTML=JSON.stringify(c.compile(x,b).spec),l.type="application/diagram-vega",l.removeAttribute("src")}catch{throw l.remove(),new Error("failed to parse vegaLite specs.")}}}let n=async()=>{o=o||await d(D,"vega")},s=async(c,l={})=>{let u=document.createElement("div");try{let b=JSON.parse(j(c));return await new o.View(o.parse(b),{...l,renderer:"svg",container:u}).runAsync(),u.querySelector("svg")?.outerHTML||""}catch{throw new Error("failed to parse vega specs.")}finally{u.remove()}},i=await h(e.innerHTML,"vega",n,s);return e.remove(),i},$t=async t=>{let e;return h(t,"plotly",async()=>{e=await d(nt,"Plotly")},n=>{let s=document.createElement("div");try{let i=JSON.parse(j(n));return e.newPlot(s,i.data,i.layout,{displayModeBar:!1}),s.querySelector("svg")?.outerHTML||""}catch{throw new Error("failed to parse plotly specs.")}finally{s.remove()}})},qt=async t=>{let e;return h(t,"svgbob",async()=>{let{svgbobWasm:n}=await import(L+"svgbob-wasm/svgbob-wasm.js");e=await n(it)},n=>e.convert_string(n),!0)},Rt=async t=>{let e;return h(t,"wavedrom",async()=>{await d($+"skins/default.js","WaveSkin"),e=await d($+"wavedrom.min.js","WaveDrom")},n=>{let s=document.createElement("div");try{let i=JSON.parse(j(n));return s.id="diagram-id",document.body.appendChild(s),e.RenderWaveForm(s.id,i,""),s.innerHTML||""}catch{throw new Error("failed to parse WaveDrom specs.")}finally{s.remove()}})},Pt=async t=>{let e;return h(t,"nomnoml",async()=>{await d(tt,"graphre"),e=await d(ot,"nomnoml")},n=>e.renderSvg(n))},Nt=async t=>{let e,r;return h(t,"elk",async()=>{let s=M+"elk-api.js",i=M+"elk-worker.min.js",c=L+"elkjs-svg/elkjs-svg.js",l=await d(s,"ELK"),u=await d(c,"elksvg");e=new l({workerUrl:A(i)}),r=new u.Renderer},s=>{try{let i=JSON.parse(j(s));return e.layout(i).then(c=>r.toSvg(c))}catch{throw new Error("failed to parse ELK JSON.")}},!0)},Ht=async t=>{let e,r;return h(t,"cytoscape",async()=>{[e,r]=await Promise.all([d(Y,"cytoscape"),d(X,"cytoscapeSvg")]),e.use(r)},s=>{let i=document.createElement("div");i.style.display="block",i.style.visibility="none",i.style.height="300px",i.style.width="300px",document.body.appendChild(i);try{let c={...JSON.parse(j(B(s))),container:i};return e(c).svg({scale:1,full:!0})}catch{throw new Error("failed to parse Cytoscape options.")}finally{i.remove()}})},Ft=async(t,e)=>{let r;return h(t,"pintora",async()=>{r=await d(st,"pintora")},s=>{let i=document.createElement("div");r.default.renderTo(s,{container:i,config:{...V("pintora",e)}});let c=i.firstElementChild;return c?.setAttribute("xmlns","http://www.w3.org/2000/svg"),c?.setAttribute("xmlns:xlink","http://www.w3.org/1999/xlink"),i.innerHTML})},_t=()=>ct?`
<script>
  class SVGContainer extends HTMLElement {
    constructor() {
      super();
      const shadowRoot = this.attachShadow({mode: 'closed'});
      shadowRoot.append(...this.childNodes);
    }
  }
  customElements.define('svg-container', SVGContainer);
<\/script>
`:"",f=t=>J(t,console.error),Yt=async(t,{config:e})=>await Promise.resolve(t).then(f(At)).then(f(Bt)).then(f(Mt)).then(f(Dt)).then(f($t)).then(f(qt)).then(f(Rt)).then(f(Pt)).then(f(Nt)).then(f(Ht)).then(f(o=>Ft(o,e))).catch(o=>(console.error(o),t))+_t();export{Yt as diagramsCompiler};
