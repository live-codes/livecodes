import{autocompletion as kt}from"@codemirror/autocomplete";import{basicSetup as vt,lineNumbers as ee,closeBrackets as Ye}from"codemirror";import{Compartment as j,EditorState as te}from"@codemirror/state";import{oneDark as qt}from"@codemirror/theme-one-dark";import{EditorView as w,keymap as oe}from"@codemirror/view";import{undo as Ut,redo as Ct}from"@codemirror/commands";import{defaultHighlightStyle as Bt,syntaxHighlighting as et,indentUnit as At,HighlightStyle as It}from"@codemirror/language";import{tags as Nt}from"@lezer/highlight";import{indentationMarkers as Dt}from"@replit/codemirror-indentation-markers";import{vscodeKeymap as Rt}from"@replit/codemirror-vscode-keymap";import{colorPicker as Pt}from"@replit/codemirror-css-color-picker";var Be=()=>document.querySelector("#editor-mode");var Ae=(t,o)=>{let i;return(...a)=>{i&&clearTimeout(i),i=setTimeout(()=>t.apply(null,a),typeof o=="function"?o():o)}};var ht=()=>navigator.userAgent.includes("Mac")||navigator.platform.includes("Mac"),Ie=t=>ht()?t.metaKey:t.ctrlKey;var Ne=()=>String(Math.random())+"-"+Date.now().toFixed();var Re=["esm.sh","skypack","esm.run","jsdelivr.esm","fastly.jsdelivr.esm","gcore.jsdelivr.esm","testingcf.jsdelivr.esm","jsdelivr.b-cdn.esm","jspm"],Pe=["jsdelivr","fastly.jsdelivr","unpkg","gcore.jsdelivr","testingcf.jsdelivr","jsdelivr.b-cdn","npmcdn"],$e=["jsdelivr.gh","fastly.jsdelivr.gh","statically","gcore.jsdelivr.gh","testingcf.jsdelivr.gh","jsdelivr.b-cdn.gh"],H={getModuleUrl:(t,{isModule:o=!0,defaultCDN:i="esm.sh",external:a}={})=>{t=t.replace(/#nobundle/g,"");let g=p=>!a||!p.includes("https://esm.sh")?p:p.includes("?")?`${p}&external=${a}`:`${p}?external=${a}`,T=De(t,o,i);return T?g(T):o?g("https://esm.sh/"+t):"https://cdn.jsdelivr.net/npm/"+t},getUrl:(t,o)=>t.startsWith("http")||t.startsWith("data:")?t:De(t,!1,o||yt())||t,cdnLists:{npm:Pe,module:Re,gh:$e},checkCDNs:async(t,o)=>{let i=[o,...H.cdnLists.npm].filter(Boolean);for(let a of i)try{if((await fetch(H.getUrl(t,a),{method:"HEAD"})).ok)return a}catch{}return H.cdnLists.npm[0]}},yt=()=>{if(globalThis.appCDN)return globalThis.appCDN;try{return new URL(location.href).searchParams.get("appCDN")||H.cdnLists.npm[0]}catch{return H.cdnLists.npm[0]}},De=(t,o,i)=>{let a=o&&t.startsWith("unpkg:")?"?module":"";t.startsWith("gh:")?t=t.replace("gh",$e[0]):t.includes(":")||(t=(i||(o?Re[0]:Pe[0]))+":"+t);for(let g of ft){let[T,p]=g;if(T.test(t))return t.replace(T,p)+a}return null},ft=[[/^(esm\.sh:)(.+)/i,"https://esm.sh/$2"],[/^(npm:)(.+)/i,"https://esm.sh/$2"],[/^(node:)(.+)/i,"https://esm.sh/$2"],[/^(jsr:)(.+)/i,"https://esm.sh/jsr/$2"],[/^(skypack:)(.+)/i,"https://cdn.skypack.dev/$2"],[/^(jsdelivr:)(.+)/i,"https://cdn.jsdelivr.net/npm/$2"],[/^(fastly\.jsdelivr:)(.+)/i,"https://fastly.jsdelivr.net/npm/$2"],[/^(gcore\.jsdelivr:)(.+)/i,"https://gcore.jsdelivr.net/npm/$2"],[/^(testingcf\.jsdelivr:)(.+)/i,"https://testingcf.jsdelivr.net/npm/$2"],[/^(jsdelivr\.b-cdn:)(.+)/i,"https://jsdelivr.b-cdn.net/npm/$2"],[/^(jsdelivr\.gh:)(.+)/i,"https://cdn.jsdelivr.net/gh/$2"],[/^(fastly\.jsdelivr\.gh:)(.+)/i,"https://fastly.jsdelivr.net/gh/$2"],[/^(gcore\.jsdelivr\.gh:)(.+)/i,"https://gcore.jsdelivr.net/gh/$2"],[/^(testingcf\.jsdelivr\.gh:)(.+)/i,"https://testingcf.jsdelivr.net/gh/$2"],[/^(jsdelivr\.b-cdn\.gh:)(.+)/i,"https://jsdelivr.b-cdn.net/gh/$2"],[/^(statically:)(.+)/i,"https://cdn.statically.io/gh/$2"],[/^(esm\.run:)(.+)/i,"https://esm.run/$2"],[/^(jsdelivr\.esm:)(.+)/i,"https://cdn.jsdelivr.net/npm/$2/+esm"],[/^(fastly\.jsdelivr\.esm:)(.+)/i,"https://fastly.jsdelivr.net/npm/$2/+esm"],[/^(gcore\.jsdelivr\.esm:)(.+)/i,"https://gcore.jsdelivr.net/npm/$2/+esm"],[/^(testingcf\.jsdelivr\.esm:)(.+)/i,"https://testingcf.jsdelivr.net/npm/$2/+esm"],[/^(jsdelivr\.b-cdn\.esm:)(.+)/i,"https://jsdelivr.b-cdn.net/npm/$2/+esm"],[/^(jspm:)(.+)/i,"https://jspm.dev/$2"],[/^(esbuild:)(.+)/i,"https://esbuild.vercel.app/$2"],[/^(bundle\.run:)(.+)/i,"https://bundle.run/$2"],[/^(unpkg:)(.+)/i,"https://unpkg.com/$2"],[/^(npmcdn:)(.+)/i,"https://npmcdn.com/$2"],[/^(bundlejs:)(.+)/i,"https://deno.bundlejs.com/?file&q=$2"],[/^(bundle:)(.+)/i,"https://deno.bundlejs.com/?file&q=$2"],[/^(deno:)(.+)/i,"https://deno.bundlejs.com/?file&q=https://deno.land/x/$2/mod.ts"],[/^(https:\/\/deno\.land\/.+)/i,"https://deno.bundlejs.com/?file&q=$1"],[/^(github:|https:\/\/github\.com\/)(.[^\/]+?)\/(.[^\/]+?)\/(?!releases\/)(?:(?:blob|raw)\/)?(.+?\/.+)/i,"https://deno.bundlejs.com/?file&q=https://cdn.jsdelivr.net/gh/$2/$3@$4"],[/^(gist\.github:)(.+?\/[0-9a-f]+\/raw\/(?:[0-9a-f]+\/)?.+)$/i,"https://gist.githack.com/$2"],[/^(gitlab:|https:\/\/gitlab\.com\/)([^\/]+.*\/[^\/]+)\/(?:raw|blob)\/(.+?)(?:\?.*)?$/i,"https://deno.bundlejs.com/?file&q=https://gl.githack.com/$2/raw/$3"],[/^(bitbucket:|https:\/\/bitbucket\.org\/)([^\/]+\/[^\/]+)\/(?:raw|src)\/(.+?)(?:\?.*)?$/i,"https://deno.bundlejs.com/?file&q=https://bb.githack.com/$2/raw/$3"],[/^(bitbucket:)snippets\/([^\/]+\/[^\/]+)\/revisions\/([^\/\#\?]+)(?:\?[^#]*)?(?:\#file-(.+?))$/i,"https://bb.githack.com/!api/2.0/snippets/$2/$3/files/$4"],[/^(bitbucket:)snippets\/([^\/]+\/[^\/\#\?]+)(?:\?[^#]*)?(?:\#file-(.+?))$/i,"https://bb.githack.com/!api/2.0/snippets/$2/HEAD/files/$3"],[/^(bitbucket:)\!api\/2.0\/snippets\/([^\/]+\/[^\/]+\/[^\/]+)\/files\/(.+?)(?:\?.*)?$/i,"https://bb.githack.com/!api/2.0/snippets/$2/files/$3"],[/^(api\.bitbucket:)2.0\/snippets\/([^\/]+\/[^\/]+\/[^\/]+)\/files\/(.+?)(?:\?.*)?$/i,"https://bb.githack.com/!api/2.0/snippets/$2/files/$3"],[/^(rawgit:)(.+?\/[0-9a-f]+\/raw\/(?:[0-9a-f]+\/)?.+)$/i,"https://gist.githack.com/$2"],[/^(rawgit:|https:\/\/raw\.githubusercontent\.com)(\/[^\/]+\/[^\/]+|[0-9A-Za-z-]+\/[0-9a-f]+\/raw)\/(.+)/i,"https://deno.bundlejs.com/?file&q=https://raw.githack.com/$2/$3"]];var{getUrl:y,getModuleUrl:Kt}=H,v=y("@live-codes/browser-compilers@0.21.1/dist/");var Fe=y("cm6-theme-basic-light@0.2.0/dist/index.js"),Oe=y("cm6-theme-basic-dark@0.2.0/dist/index.js"),We=y("cm6-theme-gruvbox-light@0.2.0/dist/index.js"),ze=y("cm6-theme-gruvbox-dark@0.2.0/dist/index.js"),Ve=y("cm6-theme-material-dark@0.2.0/dist/index.js"),_e=y("cm6-theme-nord@0.2.0/dist/index.js"),Ge=y("cm6-theme-solarized-light@0.2.0/dist/index.js"),Ke=y("cm6-theme-solarized-dark@0.2.0/dist/index.js");var b=y("@live-codes/codemirror@0.2.0/build/");var Je=y("comlink@4.4.1/dist/");var S=y("@ddietr/codemirror-themes@1.4.2/dist/theme/");var d=y("thememirror@2.0.1/dist/themes/");var Tt=t=>{let o=t.trim(),i,a;return t.includes(":")&&([i,o]=o.split(":"),i!=="monaco"&&i!=="codemirror"&&i!=="codejar"&&(i=void 0)),t.includes("@")&&([o,a]=o.split("@"),a!=="light"&&a!=="dark"&&(a=void 0)),{editor:i,editorTheme:o,theme:a}},Ze=({editor:t,editorTheme:o,theme:i,editorThemes:a})=>{if(!o)return null;let T=(typeof o=="string"?o.split(",").map(p=>p.trim()):o).map(Tt);for(let p of T)if((p.editor===t||p.editor===void 0)&&(p.theme===i||p.theme===void 0)&&a.includes(p.editorTheme))return p.editorTheme;return null};import{LanguageSupport as bt,StreamLanguage as Et}from"@codemirror/language";import{html as Lt}from"@codemirror/lang-html";import{css as Mt}from"@codemirror/lang-css";import{javascript as I}from"@codemirror/lang-javascript";import{json as St}from"@codemirror/lang-json";var x=t=>new bt(Et.define(t)),c=t=>b+t,l={vue:c("codemirror-lang-vue.js"),json:c("codemirror-lang-json.js"),markdown:c("codemirror-lang-markdown.js"),python:c("codemirror-lang-python.js"),php:c("codemirror-lang-php.js"),cpp:c("codemirror-lang-cpp.js"),sql:c("codemirror-lang-sql.js"),wast:c("codemirror-lang-wast.js"),scss:c("codemirror-lang-scss.js"),coffeescript:c("codemirror-lang-coffeescript.js"),livescript:c("codemirror-lang-livescript.js"),ruby:c("codemirror-lang-ruby.js"),go:c("codemirror-lang-go.js"),perl:c("codemirror-lang-perl.js"),lua:c("codemirror-lang-lua.js"),r:c("codemirror-lang-r.js"),julia:c("codemirror-lang-julia.js"),scheme:c("codemirror-lang-scheme.js"),clojure:c("codemirror-lang-clojure.js"),tcl:c("codemirror-lang-tcl.js"),less:c("codemirror-lang-less.js"),stylus:c("codemirror-lang-stylus.js"),rust:c("codemirror-lang-rust.js"),swift:c("codemirror-lang-swift.js")},X={html:async()=>Lt(),css:async()=>Mt(),javascript:async()=>I(),typescript:async()=>I({typescript:!0}),jsx:async()=>I({jsx:!0}),tsx:async()=>I({jsx:!0,typescript:!0}),json:async()=>St(),vue:async()=>(await import(l.vue)).vue(),markdown:async()=>(await import(l.markdown)).markdown(),python:async()=>(await import(l.python)).python(),php:async()=>(await import(l.php)).php(),cpp:async()=>(await import(l.cpp)).cpp(),sql:async()=>(await import(l.sql)).sql(),wat:async()=>(await import(l.wast)).wast(),scss:async()=>(await import(l.scss)).sass(),sass:async()=>(await import(l.scss)).sass({indented:!0}),coffeescript:async()=>x((await import(l.coffeescript)).coffeeScript),livescript:async()=>x((await import(l.livescript)).liveScript),ruby:async()=>x((await import(l.ruby)).ruby),go:async()=>x((await import(l.go)).go),perl:async()=>x((await import(l.perl)).perl),lua:async()=>x((await import(l.lua)).lua),r:async()=>x((await import(l.r)).r),julia:async()=>x((await import(l.julia)).julia),scheme:async()=>x((await import(l.scheme)).scheme),clojure:async()=>x((await import(l.clojure)).clojure),tcl:async()=>x((await import(l.tcl)).tcl),less:async()=>x((await import(l.less)).less),stylus:async()=>x((await import(l.stylus)).stylus),rust:async()=>x((await import(l.rust)).rust),swift:async()=>x((await import(l.swift)).swift)};import{EditorView as Ht}from"@codemirror/view";import{HighlightStyle as jt,syntaxHighlighting as wt}from"@codemirror/language";var Y=[{name:"amy",title:"Amy",url:d+"amy.js",exportName:"amy"},{name:"aura",title:"Aura",url:S+"aura.js",exportName:"aura"},{name:"ayu-light",title:"Ayu Light",url:d+"ayu-light.js",exportName:"ayuLight"},{name:"barf",title:"Barf",url:d+"barf.js",exportName:"barf"},{name:"basic-light",title:"Basic Light",url:Fe,exportName:"basicLight"},{name:"basic-dark",title:"Basic Dark",url:Oe,exportName:"basicDark"},{name:"bespin",title:"Bespin",url:d+"bespin.js",exportName:"bespin"},{name:"birds-of-paradise",title:"Birds of Paradise",url:d+"birds-of-paradise.js",exportName:"birdsOfParadise"},{name:"boys-and-girls",title:"Boys and Girls",url:d+"boys-and-girls.js",exportName:"boysAndGirls"},{name:"catppuccin-latte",title:"Catppuccin Latte",url:v+"catppuccin/codemirror/codemirror-theme-catppuccin.js",exportName:"catppuccinLatte"},{name:"catppuccin-frappe",title:"Catppuccin Frappe",url:v+"catppuccin/codemirror/codemirror-theme-catppuccin.js",exportName:"catppuccinFrappe"},{name:"catppuccin-macchiato",title:"Catppuccin Macchiato",url:v+"catppuccin/codemirror/codemirror-theme-catppuccin.js",exportName:"catppuccinMacchiato"},{name:"catppuccin-mocha",title:"Catppuccin Mocha",url:v+"catppuccin/codemirror/codemirror-theme-catppuccin.js",exportName:"catppuccinMocha"},{name:"clouds",title:"Clouds",url:d+"clouds.js",exportName:"clouds"},{name:"cobalt",title:"Cobalt",url:d+"cobalt.js",exportName:"cobalt"},{name:"cm-light",title:"Codemirror Light"},{name:"cool-glow",title:"Cool Glow",url:d+"cool-glow.js",exportName:"coolGlow"},{name:"dracula",title:"Dracula",url:d+"dracula.js",exportName:"dracula"},{name:"espresso",title:"Espresso",url:d+"espresso.js",exportName:"espresso"},{name:"github-dark",title:"GitHub Dark",url:S+"github-dark.js",exportName:"githubDark"},{name:"github-light",title:"GitHub Light",url:S+"github-light.js",exportName:"githubLight"},{name:"gruvbox-dark",title:"Gruvbox Dark",url:ze,exportName:"gruvboxDark"},{name:"gruvbox-light",title:"Gruvbox Light",url:We,exportName:"gruvboxLight"},{name:"material-dark",title:"Material Dark",url:Ve,exportName:"materialDark"},{name:"material-light",title:"Material Light",url:S+"material-light.js",exportName:"materialLight"},{name:"monochrome",title:"Monochrome"},{name:"monochrome-dark",title:"Monochrome Dark"},{name:"noctis-lilac",title:"Noctis Lilac",url:d+"noctis-lilac.js",exportName:"noctisLilac"},{name:"nord",title:"Nord",url:_e,exportName:"nord"},{name:"one-dark",title:"One Dark"},{name:"rose-pine-dawn",title:"Ros\xE9 Pine Dawn",url:d+"rose-pine-dawn.js",exportName:"rosePineDawn"},{name:"smoothy",title:"Smoothy",url:d+"smoothy.js",exportName:"smoothy"},{name:"solarized-dark",title:"Solarized Dark",url:Ke,exportName:"solarizedDark"},{name:"solarized-light",title:"Solarized Light",url:Ge,exportName:"solarizedLight"},{name:"tokyo-night",title:"Tokyo Night",url:S+"tokyo-night.js",exportName:"tokyoNight"},{name:"tokyo-night-day",title:"Tokyo Night Day",url:S+"tokyo-night-day.js",exportName:"tokyoNightDay"},{name:"tokyo-night-storm",title:"Tokyo Night Storm",url:S+"tokyo-night-storm.js",exportName:"tokyoNightStorm"},{name:"tomorrow",title:"Tomorrow",url:d+"tomorrow.js",exportName:"tomorrow"}],Qe=({variant:t,settings:o,styles:i})=>{let a=Ht.theme({"&":{backgroundColor:o.background,color:o.foreground},".cm-content":{caretColor:o.caret},".cm-cursor, .cm-dropCursor":{borderLeftColor:o.caret},"&.cm-focused .cm-selectionBackgroundm .cm-selectionBackground, .cm-selectionMatch, .cm-content ::selection":{backgroundColor:o.selection},".cm-activeLine":{backgroundColor:o.lineHighlight},".cm-gutters":{backgroundColor:o.gutterBackground,color:o.gutterForeground},".cm-activeLineGutter":{backgroundColor:o.lineHighlight}},{dark:t==="dark"}),g=jt.define(i);return[a,wt(g)]},Xe={monochrome:Qe({variant:"light",settings:{background:"#fffffe",foreground:"#24292e",caret:"#24292e",selection:"#c8c8fa",gutterBackground:"#fffffe",gutterForeground:"#24292e",lineHighlight:"#f1faff"},styles:[]}),"monochrome-dark":Qe({variant:"dark",settings:{background:"#24292e",foreground:"#e2e2e3",caret:"#e2e2e3",selection:"#444d56",gutterBackground:"#24292e",gutterForeground:"#e2e2e3",lineHighlight:"#444d56"},styles:[]})};var N=[],re,D=!1,$t=Ae(()=>D=!D,50),jo=async t=>{let{container:o,readonly:i,isEmbed:a,editorId:g,getFormatterConfig:T,getFontFamily:p,getLanguageExtension:tt}=t,u={...t};if(!o)throw new Error("editor container not found");let ne=async e=>X[e]?.()||X.html?.(),R=e=>["vue","vue3","vue2"].includes(e)?"vue":t.mapLanguage?.(e)||e,q={"one-dark":qt,"cm-light":[et(Bt),w.theme({"&":{backgroundColor:"#ffffff"}})],...Xe},se={dark:"one-dark",light:"cm-light"},ce=()=>q[le]||q[se[t.theme]]||[],k=t.language,E=R(k),P=await ne(E),le=await ke(t.theme,t.editorTheme),U=[],$=[],ot=e=>{e.docChanged&&$.forEach(r=>r(e))},L,F,O,W,z,V,ie=e=>E==="typescript"?e:E==="javascript"?e.slice(0,-1):[],ae,me=new Promise(e=>ae=e),pe=async(e=!1)=>{let r=L&&e?"changeCodeMirrorLanguage":"initCodeMirrorTS";if(e&&(L=void 0),!["typescript","javascript"].includes(E)||L)return;let n=`${b}codemirror-ts.js`,[m,h,f]=await Promise.all([import(n),import(Je+"esm/comlink.min.js"),window.compiler.typescriptFeatures({feature:r,payload:k})]),{tsFacetWorker:M,tsSyncWorker:C,tsLinterWorker:Q,tsAutocompleteWorker:B,tsHoverWorker:ut}=m;if(!re){let Ue=document.querySelector("#compiler-frame");if(!Ue?.contentWindow)return;let Ce=h.wrap(h.windowEndpoint(Ue.contentWindow));await Ce.initialize(),re=Ce}let dt=Ne(),A=tt(k),gt=E==="typescript"&&!A?.endsWith("ts")&&!A?.endsWith("tsx")?A+".tsx":A,xt=`/${g}.${dt}.${gt}`;L=L||[M.of({worker:re,path:xt}),C(),kt({override:[B()]}),ut(),Q()],s.dispatch({effects:[ge.reconfigure(ie(L))]})},rt=e=>{me.then(()=>{window.compiler.typescriptFeatures({feature:"addTypes",payload:e})})},ue=async e=>{let r={vim:`${b}codemirror-vim.js`,emacs:`${b}codemirror-emacs.js`,emmet:`${b}codemirror-emmet.js`,codeium:`${b}codemirror-codeium.js`,lineNumbersRelative:`${b}codemirror-line-numbers-relative.js`},[n,m,h,f,M]=await Promise.all([e.editorMode==="vim"?import(r.vim):Promise.resolve({}),e.editorMode==="emacs"?import(r.emacs):Promise.resolve({}),e.emmet?import(r.emmet):Promise.resolve({}),e.enableAI?import(r.codeium):Promise.resolve({}),e.lineNumbers==="relative"?import(r.lineNumbersRelative):Promise.resolve({})]);F=n.vim,O=m.emacs,W=h.emmet,z=f.codeium,V=M.lineNumbersRelative};await ue(t);let de=new j,ge=new j,xe=new j,he=new j,_=w.editable.of(!1),ye=new j,nt=new j,fe=new j,st=It.define([{tag:Nt.comment,fontStyle:"italic"}]),Te=e=>{let r=(e.fontSize??u.fontSize)||(a?12:14),n=p(e.fontFamily??u.fontFamily),m=e.tabSize??u.tabSize,h=e.useTabs??u.useTabs,f=e.wordWrap??u.wordWrap,M=e.emmet??u.emmet,C=e.lineNumbers??u.lineNumbers,Q=e.enableAI??u.enableAI,B=e.editorMode??u.editorMode;return[te.tabSize.of(m),At.of(h?"	":" ".repeat(m)),...f?[w.lineWrapping]:[],...B==="vim"&&F?[F()]:B==="emacs"&&O?[O()]:[],...M&&W?[W]:[],...C==="relative"&&V?[V()]:C&&ee?[ee()]:[],...Q&&z?[z(N,R)]:[],w.theme({"&":{height:"100%",fontSize:r+"px"},".cm-scroller":{overflow:"auto",fontFamily:n}})]},be=()=>{let e=[de.of(P),ge.of(["typescript","javascript"].includes(E)&&L?ie(L):[]),w.updateListener.of(ot),he.of(ce()),et(st),ye.of(Te({})),xe.of(oe.of(U)),fe.of(u.closeBrackets?Ye():[]),vt,i?_:[],oe.of(Rt),Dt(),Pt],r=[_,...e],n=[_,...e],m=[...e];return g==="console"?m:g==="compiled"?n:t.mode==="codeblock"?r:e},Ee=async e=>{let r=Be(),n=m=>{r&&(r.textContent=m)};e||n(""),e==="vim"&&n("Vim"),e==="emacs"&&n("Emacs")},s=new w({state:te.create({extensions:be(),doc:t.value}),parent:o});Ee(t.editorMode);let ct=()=>g,G=()=>s.state.doc.toString(),K=(e="",r=!0)=>{r?s.setState(te.create({doc:e,extensions:be()})):s.dispatch({changes:{from:0,to:s.state.doc.length,insert:e}})},Le=()=>s.focus(),Me=()=>k,lt=(e,r)=>{k=e,E=R(k),ne(E).then(n=>{P=n,s.dispatch({effects:[de.reconfigure(P)]})}),me.then(()=>{pe(!0)}),r!=null&&K(r)},Se={editorId:g,getLanguage:Me,getValue:G};N.push(Se),pe().then(()=>{ae()});let it=e=>{$.push(e)},He={CtrlEnter:"Ctrl-Enter",ShiftEnter:"Shift-Enter",Enter:"Enter",UpArrow:"ArrowUp",DownArrow:"ArrowDown",ShiftAltF:"Shift-Alt-f"},J=(e,r,n)=>{U.push({key:r,run(){return n(),!0}}),s.dispatch({effects:xe.reconfigure(oe.of(U))})},je=e=>{e.code==="KeyM"&&Ie(e)&&(e.preventDefault(),$t(),setTimeout(()=>{s.setTabFocusMode?.(D)},70))};s.setTabFocusMode(D),addEventListener("keydown",je);let Z,at=e=>{e&&(Z=e,J("format",He.ShiftAltF,async()=>{await we(),Le()}))},we=async()=>{if(!Z)return;let e=s.state.selection.main.to,r=G(),n=await Z(r,e,T());K(n.formatted,!1);let m=n.cursorOffset>=0?n.cursorOffset:0;s.dispatch({selection:{anchor:m}})};async function ke(e,r){let n=Ze({editor:"codemirror",editorTheme:r,theme:e,editorThemes:Y.map(f=>f.name)}),m=n||se[e],h=Y.find(f=>f.name===m);if(!q[m]&&h?.url){let f=(await import(h.url))[h.exportName||"default"];q[m]=f}return m}let ve=(e,r)=>{ke(e,r).then(n=>{le=n,s.dispatch({effects:he.reconfigure(ce())})})},mt=e=>{u={...e},ue(u).then(()=>{s.dispatch({effects:[ye.reconfigure(Te(u)),nt.reconfigure(u.lineNumbers?ee():[]),fe.reconfigure(u.closeBrackets?Ye():[])]}),ve(u.theme,u.editorTheme),Ee(u.editorMode)})},pt=()=>{Ut({state:s.state,dispatch:s.dispatch})},qe=()=>{Ct({state:s.state,dispatch:s.dispatch})};return J("redo","Mod-Shift-z",qe),{getValue:G,setValue:K,getLanguage:Me,setLanguage:lt,getEditorId:ct,focus:Le,getPosition:()=>{let e=s.state.selection.asSingle().ranges[0].from,r=s.state.doc.lineAt(e),n=r.number,m=e-r.from+1;return{lineNumber:n,column:m}},setPosition:({lineNumber:e,column:r=1})=>{let n=r-1,m=s.state.doc.lines>e?e:s.state.doc.lines,h=s.state.doc.line(m),f=h.length>n?n:h.length,M=h.from+f;s.dispatch({selection:{anchor:M},effects:[w.scrollIntoView(M,{x:"center",y:"center"})]})},addTypes:rt,onContentChanged:it,keyCodes:He,addKeyBinding:J,changeSettings:mt,registerFormatter:at,format:we,isReadonly:i,setTheme:ve,undo:pt,redo:qe,destroy:()=>{$.length=0,U.length=0,s.destroy(),o.innerHTML="",N.splice(N.indexOf(Se),1),removeEventListener("keydown",je)},codemirror:s}};export{jo as createEditor};
