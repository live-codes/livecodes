var X=t=>JSON.parse(JSON.stringify(t));var Y=()=>String(Math.random())+"-"+Date.now().toFixed();var A=(t,s)=>new Promise((i,c)=>{if(s&&globalThis[s])return i(globalThis[s]);if(typeof globalThis.importScripts=="function")return globalThis.importScripts(t),s&&globalThis[s]?i(globalThis[s]):i(globalThis);let l=document.createElement("script");l.src=t,l.async=!0;let o=()=>{l.removeEventListener("load",d),l.removeEventListener("error",T)},d=()=>{if(o(),!s)return i("loaded: "+t);let m=setInterval(()=>{if(window[s])return clearInterval(m),i(window[s])},5)},T=()=>{o(),c("failed to load: "+t)};l.addEventListener("load",d),l.addEventListener("error",T),document.head.appendChild(l)});var W=t=>t.replace(/\/\*[\s\S]*?\*\/|([^\\:]|^)\/\/.*$/gm,"$1");var te=["jspm","skypack"],oe=["unpkg","jsdelivr","fastly.jsdelivr"],ne=["fastly.jsdelivr.gh","jsdelivr.gh","statically"],H={getModuleUrl:(t,{isModule:s=!0,defaultCDN:i="jspm"}={})=>{t=t.replace(/#nobundle/g,"");let c=ee(t,s,i);return c||(s?"https://jspm.dev/"+t:"https://cdn.jsdelivr.net/npm/"+t)},getUrl:(t,s)=>t.startsWith("http")?t:ee(t,!1,s||Fe())||t,cdnLists:{npm:oe,module:te,gh:ne},checkCDNs:async(t,s)=>{let i=[s,...H.cdnLists.npm].filter(Boolean);for(let c of i)try{if((await fetch(H.getUrl(t,c),{method:"HEAD"})).ok)return c}catch{}return H.cdnLists.npm[0]}},Fe=()=>{if(globalThis.appCDN)return globalThis.appCDN;try{return new URL(location.href).searchParams.get("appCDN")||H.cdnLists.npm[0]}catch{return H.cdnLists.npm[0]}},ee=(t,s,i)=>{let c=s&&t.startsWith("unpkg:")?"?module":"";t.startsWith("gh:")?t=t.replace("gh",ne[0]):t.includes(":")||(t=(i||(s?te[0]:oe[0]))+":"+t);for(let l of _e){let[o,d]=l;if(o.test(t))return t.replace(o,d)+c}return null},_e=[[/^(jspm:)(.+)/i,"https://jspm.dev/$2"],[/^(npm:)(.+)/i,"https://jspm.dev/$2"],[/^(node:)(.+)/i,"https://jspm.dev/$2"],[/^(skypack:)(.+)/i,"https://cdn.skypack.dev/$2"],[/^(jsdelivr:)(.+)/i,"https://cdn.jsdelivr.net/npm/$2"],[/^(fastly.jsdelivr:)(.+)/i,"https://fastly.jsdelivr.net/npm/$2"],[/^(jsdelivr.gh:)(.+)/i,"https://cdn.jsdelivr.net/gh/$2"],[/^(fastly.jsdelivr.gh:)(.+)/i,"https://fastly.jsdelivr.net/gh/$2"],[/^(statically:)(.+)/i,"https://cdn.statically.io/gh/$2"],[/^(esm.run:)(.+)/i,"https://esm.run/$2"],[/^(esm.sh:)(.+)/i,"https://esm.sh/$2"],[/^(esbuild:)(.+)/i,"https://esbuild.vercel.app/$2"],[/^(bundle.run:)(.+)/i,"https://bundle.run/$2"],[/^(unpkg:)(.+)/i,"https://unpkg.com/$2"],[/^(bundlejs:)(.+)/i,"https://deno.bundlejs.com/?file&q=$2"],[/^(bundle:)(.+)/i,"https://deno.bundlejs.com/?file&q=$2"],[/^(deno:)(.+)/i,"https://deno.bundlejs.com/?file&q=https://deno.land/x/$2/mod.ts"],[/^(https:\/\/deno\.land\/.+)/i,"https://deno.bundlejs.com/?file&q=$1"],[/^(github:|https:\/\/github\.com\/)(.[^\/]+?)\/(.[^\/]+?)\/(?!releases\/)(?:(?:blob|raw)\/)?(.+?\/.+)/i,"https://deno.bundlejs.com/?file&q=https://cdn.jsdelivr.net/gh/$2/$3@$4"],[/^(gist\.github:)(.+?\/[0-9a-f]+\/raw\/(?:[0-9a-f]+\/)?.+)$/i,"https://gist.githack.com/$2"],[/^(gitlab:|https:\/\/gitlab\.com\/)([^\/]+.*\/[^\/]+)\/(?:raw|blob)\/(.+?)(?:\?.*)?$/i,"https://deno.bundlejs.com/?file&q=https://gl.githack.com/$2/raw/$3"],[/^(bitbucket:|https:\/\/bitbucket\.org\/)([^\/]+\/[^\/]+)\/(?:raw|src)\/(.+?)(?:\?.*)?$/i,"https://deno.bundlejs.com/?file&q=https://bb.githack.com/$2/raw/$3"],[/^(bitbucket:)snippets\/([^\/]+\/[^\/]+)\/revisions\/([^\/\#\?]+)(?:\?[^#]*)?(?:\#file-(.+?))$/i,"https://bb.githack.com/!api/2.0/snippets/$2/$3/files/$4"],[/^(bitbucket:)snippets\/([^\/]+\/[^\/\#\?]+)(?:\?[^#]*)?(?:\#file-(.+?))$/i,"https://bb.githack.com/!api/2.0/snippets/$2/HEAD/files/$3"],[/^(bitbucket:)\!api\/2.0\/snippets\/([^\/]+\/[^\/]+\/[^\/]+)\/files\/(.+?)(?:\?.*)?$/i,"https://bb.githack.com/!api/2.0/snippets/$2/files/$3"],[/^(api\.bitbucket:)2.0\/snippets\/([^\/]+\/[^\/]+\/[^\/]+)\/files\/(.+?)(?:\?.*)?$/i,"https://bb.githack.com/!api/2.0/snippets/$2/files/$3"],[/^(rawgit:)(.+?\/[0-9a-f]+\/raw\/(?:[0-9a-f]+\/)?.+)$/i,"https://gist.githack.com/$2"],[/^(rawgit:|https:\/\/raw\.githubusercontent\.com)(\/[^\/]+\/[^\/]+|[0-9A-Za-z-]+\/[0-9a-f]+\/raw)\/(.+)/i,"https://deno.bundlejs.com/?file&q=https://raw.githack.com/$2/$3"]];var{getUrl:B,getModuleUrl:ot}=H;var re=B("emmet-monaco-es@5.0.0/dist/emmet-monaco.js");var Ve="0.6.64",nt=B(`malinajs@${Ve}/malina.js`);var se=B("monaco-emacs@0.3.0/dist/monaco-emacs.js"),ce=B("monaco-vim@0.4.0/dist/monaco-vim.js");var Je=/(import\s+?(?:(?:(?:[\w*\s{},\$]*)\s+from\s+?)|))((?:".*?")|(?:'.*?'))([\s]*?(?:;|$|))/g,Ke=/(import\s*?\(\s*?((?:".*?")|(?:'.*?'))\s*?\))/g,ie=t=>[...W(t).matchAll(new RegExp(Je)),...W(t).matchAll(new RegExp(Ke))].map(s=>s[2].replace(/"/g,"").replace(/'/g,""));var le=()=>document.querySelector("#editor-mode");var ae=t=>`https://ofcncog2cu-dsn.algolia.net/1/indexes/npm-search/${encodeURIComponent(t)}?x-algolia-agent=Browser`,pe={"X-Algolia-Application-Id":"OFCNCOG2CU","X-Algolia-API-Key":"f54e21fa3a2a0160595bb058179bfb1e"},ue=["name","description","homepage","repository.url","version"],N="https://data.jsdelivr.com/v1",O={"User-Agent":"https://livecodes.io"},j=t=>{let s=t.startsWith("@"),i=s?t.slice(1):t,[c,l]=i.split("@");return[(s?"@":"")+c,l]},ze=async(t,s=10)=>{let i={page:0,hitsPerPage:s,attributesToHighlight:[],attributesToRetrieve:ue,analyticsTags:["jsdelivr"]},[c,l]=j(t),o;if(l){let m=await $(t);typeof m=="string"&&(o=j(m)[1])}let d=await fetch(ae("query"),{method:"POST",headers:{"Content-Type":"application/json; charset=UTF-8",...pe},body:JSON.stringify({query:c,...i})}).then(m=>{if(!m.ok)throw new Error("failed to fetch");return m}).then(m=>m.json()).catch(m=>({error:!0,message:m.mesage||String(m)}));if("error"in d)return d;let T=d.hits.map(m=>(m.name===c&&o&&(m.version=o),m.repository?.url&&(m.repo=m.repository?.url),m));return T.sort((m,P)=>m.name===c?-1:P.name===c?1:0),T},$=async t=>{let s=`${N}/package/resolve/npm/${t}`,i=await fetch(s,{headers:O}).then(o=>{if(!o.ok)throw new Error("failed to fetch");return o}).then(o=>o.json()).catch(o=>({error:!0,message:o.mesage||String(o)}));if("error"in i)return i;let c=j(t)[0],l=i.version;return l?`${c}@${l}`:c},Ge=async t=>{let[s,i]=j(t),c;if(i){let d=await $(t);typeof d=="string"&&(c=j(d)[1])}let l=ae(s)+"&attributesToRetrieve="+ue.join(","),o=await fetch(l,{method:"GET",headers:pe}).then(d=>{if(!d.ok)throw new Error("failed to fetch");return d}).then(d=>d.json()).catch(d=>({error:!0,message:d.mesage||String(d)}));return"error"in o||(c&&(o.version=c),o.repository?.url&&(o.repo=o.repository?.url)),o},Ze=async t=>{let s=await $(t),i=`${N}/package/npm/${s}/flat`,c=await fetch(i,{headers:O}).then(o=>{if(!o.ok)throw new Error("failed to fetch");return o}).then(o=>o.json()).catch(o=>({error:!0,message:o.mesage||String(o)}));if("error"in c)return c;let l=`https://cdn.jsdelivr.net/npm/${s}`;return{...c.default?{default:l+c.default}:{},files:c.files.map(o=>l+o.name)}},Qe=async t=>{let s=await $(t),i=`${N}/package/npm/${s}/entrypoints`,c=await fetch(i,{headers:O}).then(o=>{if(!o.ok)throw new Error("failed to fetch");return o}).then(o=>o.json()).catch(o=>({error:!0,message:o.mesage||String(o)}));if("error"in c)return c;let l=`https://cdn.jsdelivr.net/npm/${s}`;return{...c.js?.file?{js:l+c.js?.file}:{},...c.css?.file?{css:l+c.css?.file}:{}}},me={search:ze,getPkgInfo:Ge,getPkgFiles:Ze,getPkgDefaultFiles:Qe};var de=!1,b={},r,kt=async t=>{let{container:s,baseUrl:i,readonly:c,theme:l,isEmbed:o,getLanguageExtension:d,mapLanguage:T,getFormatterConfig:m,getFontFamily:P}=t;if(!s)throw new Error("editor container not found");let f,F=e=>({fontFamily:P(e.fontFamily),fontSize:e.fontSize||(o?12:14),insertSpaces:!e.useTabs,detectIndentation:!1,tabSize:e.tabSize,lineNumbers:e.lineNumbers?"on":"off",wordWrap:e.wordWrap?"on":"off",autoClosingBrackets:e.closeBrackets?"always":"never",autoClosingQuotes:e.closeBrackets?"always":"never",autoClosingDelete:e.closeBrackets?"always":"never"}),ge=F(t),v=e=>e==="livescript"?"coffeescript":["rescript","reason","ocaml"].includes(e)?"csharp":T(e),L=i+"vendor/monaco-editor/v0.32.1";try{window.monaco=window.monaco||(await import(`${L}/monaco-editor.js`)).monaco,r=window.monaco}catch{throw new Error("Failed to load monaco editor")}r.editor.defineTheme("custom-vs-light",{base:"vs",inherit:!0,rules:[{token:"comment",fontStyle:"italic"}],colors:{}}),r.editor.defineTheme("custom-vs-dark",{base:"vs-dark",inherit:!0,rules:[{token:"comment",fontStyle:"italic"}],colors:{}});let C={theme:"custom-vs-"+l,fontLigatures:!0,formatOnType:!1,lineNumbersMinChars:3,minimap:{enabled:!1},scrollbar:{useShadows:!1},mouseWheelZoom:!0,automaticLayout:!0,readOnly:c},fe={...C,scrollBeyondLastLine:!1,contextmenu:!1},xe={...C,scrollBeyondLastLine:!1},_={...C,glyphMargin:!0,folding:!1,lineDecorationsWidth:0,lineNumbersMinChars:0,scrollbar:{vertical:"auto"},scrollBeyondLastLine:!1,contextmenu:!1},ye={..._},q=t.editorId,V=q==="console"?_:q==="compiled"?xe:q==="embed"?ye:t.mode==="codeblock"?fe:C,S=X({...ge,...V});if(!document.head.querySelector("#__livecodes__monaco-styles")){let e=document.createElement("link");e.setAttribute("rel","stylesheet"),e.setAttribute("href",`${L}/monaco-editor.css`),e.id="__livecodes__monaco-styles",document.head.appendChild(e)}window.MonacoEnvironment={getWorkerUrl(e,n){return n==="json"?`${L}/json.worker.js`:n==="css"?`${L}/css.worker.js`:n==="scss"?`${L}/css.worker.js`:n==="sass"?`${L}/css.worker.js`:n==="less"?`${L}/css.worker.js`:n==="html"?`${L}/html.worker.js`:n==="typescript"||n==="javascript"?`${L}/ts.worker.js`:`${L}/editor.worker.js`}};let he=()=>{let e={jsx:r.languages.typescript.JsxEmit.Preserve,allowNonTsExtensions:!0,allowJs:!1,target:r.languages.typescript.ScriptTarget.Latest,experimentalDecorators:!0,allowSyntheticDefaultImports:!0,lib:["esnext","dom"],module:r.languages.typescript.ModuleKind.ESNext};r.languages.typescript.typescriptDefaults.setCompilerOptions(e),(x==="tsx"||x==="jsx"||x==="sucrase"||x==="babel"||x==="flow")&&r.languages.typescript.typescriptDefaults.setCompilerOptions({...e,jsx:r.languages.typescript.JsxEmit.React,jsxFactory:"React.createElement",reactNamespace:"React"}),x==="stencil"&&r.languages.typescript.typescriptDefaults.setCompilerOptions({...e,jsx:r.languages.typescript.JsxEmit.Preserve,jsxFactory:void 0,reactNamespace:"h"}),x==="flow"?r.languages.typescript.typescriptDefaults.setDiagnosticsOptions({noSemanticValidation:!0}):["typescript"].includes(T(x))&&r.languages.typescript.typescriptDefaults.setDiagnosticsOptions({noSemanticValidation:!1})},R=[],Ee=()=>{R.forEach(e=>a.getModel()?.onDidChangeContent(e))},J="",K=(e,n,u)=>{let E=Y(),g=d(u),p=v(u)==="typescript"&&!g?.endsWith("ts")&&!g?.endsWith("tsx")?g+".tsx":g;J=`file:///${q}.${E}.${p}`;let h=e.getModel(),y=r.editor.createModel(n||"",v(u),r.Uri.parse(J));e.setModel(y),setTimeout(()=>h?.dispose(),1e3),Ee(),he()},x=t.language,a=r.editor.create(s,{...S,language:v(x)});K(a,t.value,x),S.theme==="vs-light"&&(s.style.backgroundColor="#fff"),(S.theme?.startsWith("http")||S.theme?.startsWith("./"))&&fetch(S.theme).then(e=>e.json()).then(e=>{r.editor.defineTheme("theme",e),r.editor.setTheme("theme"),s.style.backgroundColor=e.colors["editor.background"]});let Le={astro:i+"monaco-lang-astro.31ace80fb590384d92861650cd635109.js",clio:i+"monaco-lang-clio.bdef68dfea0312fab9a27b5d87146182.js",imba:i+"monaco-lang-imba.b0acc149ca1c00547c24cad4172e8f22.js",wat:i+"monaco-lang-wat.90de1d50eb45ed8f299322a2d8c6f760.js"},be=async e=>{let n=Le[e];if(n&&!r.languages.getLanguages().find(u=>u.id===e)){let u=(await import(n)).default;r.languages.register({id:e}),u.config&&r.languages.setLanguageConfiguration(e,u.config),u.tokens&&r.languages.setMonarchTokensProvider(e,u.tokens)}},Me=()=>q,Te=()=>a.getValue(),Se=(e="")=>{a.getModel()?.setValue(e)},U=[],D=e=>!e.filename.startsWith("file:///node_modules/"),z=(e=!0)=>{U.filter(n=>e?!0:D(n)).forEach(n=>{n.libJs.dispose(),n.libTs.dispose()}),U.length=0},we=()=>x,He=(e,n)=>{x=e,z(!1),K(a,n??a.getValue(),x),be(e)},ke=e=>{let n=U.find(u=>u.filename===e.filename);if(n){D(e)&&(n.libJs.dispose(),n.libJs=r.languages.typescript.javascriptDefaults.addExtraLib(e.content,e.filename));return}U.push({filename:e.filename,libJs:r.languages.typescript.javascriptDefaults.addExtraLib(e.content,e.filename),libTs:D(e)?{dispose:()=>{}}:r.languages.typescript.typescriptDefaults.addExtraLib(e.content,e.filename)})},ve=()=>a.focus(),qe=()=>a.layout(),je=e=>{R.push(e),a.getModel()?.onDidChangeContent(e)},Ce={CtrlEnter:r.KeyMod.CtrlCmd|r.KeyCode.Enter,ShiftEnter:r.KeyMod.Shift|r.KeyCode.Enter,Enter:r.KeyCode.Enter,UpArrow:r.KeyCode.UpArrow,DownArrow:r.KeyCode.DownArrow,ShiftAltF:r.KeyMod.Shift|r.KeyMod.Alt|r.KeyCode.KeyF},Ue=(e,n,u)=>{a.addAction({id:e,label:e,keybindings:[n],precondition:"!suggestWidgetVisible && !markersNavigationVisible && !findWidgetVisible",run:u})},G=async e=>{let n=le(),u=document.querySelector(`#editor-status [data-status="${t.editorId}"]`),E=p=>{n&&(n.textContent=p)},g=p=>{u&&(u.textContent=p)};if(!e){f?.dispose(),f=void 0,g(""),E("");return}if(e==="vim"){if(f?.mode==="vim")return;f?.mode==="emacs"&&(f.dispose(),g(""));let p=await A(ce,"MonacoVim"),h=u?.innerHTML!==""?void 0:u;f=p.initVimMode(a,h),f.mode="vim",E("Vim")}if(e==="emacs"){if(f?.mode==="emacs")return;f?.mode==="vim"&&(f.dispose(),g(""));let p=await A(se,"MonacoEmacs");f=new p.EmacsExtension(a),g(""),f.onDidMarkChange(function(h){g(h?"Mark Set!":"Mark Unset")}),f.onDidChangeKey(function(h){g(h)}),f.start(),f.mode="emacs",E("Emacs")}};G(t.editorMode);let Ie=e=>{let n=a.getModel();!e||!n||r.languages.registerDocumentFormattingEditProvider(v(x),{provideDocumentFormattingEdits:async()=>{let u=a.getValue(),E=await e(u,0,m());return[{range:n.getFullModelRange(),text:E.formatted}]}})},Ae=()=>a.getAction("editor.action.formatDocument").run(),Z=e=>{!e&&!window.emmetMonaco||A(re,"emmetMonaco").then(n=>{e?(!b.html||b.disabled)&&(b.html=n.emmetHTML(r,["html","php","astro","markdown","mdx"]),b.css=n.emmetCSS(r,["css","scss","less"]),b.jsx=n.emmetJSX(r,["javascript","typescript","jsx","tsx"]),b.disabled=!1):(b.html?.(),b.css?.(),b.jsx?.(),b.disabled=!0)})},Be=e=>{r.editor.setTheme("custom-vs-"+e)},$e=e=>{S={...F(e),...V},Z(e.emmet),G(e.editorMode),a.updateOptions(S)},Pe=()=>{a.getModel()?.undo?.()},Re=()=>{a.getModel()?.redo?.()},De=()=>{let e=a.getPosition();return{lineNumber:e?.lineNumber??0,column:e?.column??0}},We=e=>{let n={lineNumber:e.lineNumber,column:e.column??0};a.setPosition(n),setTimeout(()=>a.revealPositionInCenter(n,0),50)},Ne=()=>{Z(!1),f?.dispose(),R.length=0,z(!0),a.getModel()?.dispose(),a.dispose(),s.innerHTML=""};window.addEventListener("unhandledrejection",function(e){e.reason&&e.reason.name==="Canceled"&&e.preventDefault()});let Oe=e=>{let n=["html","markdown","javascript","typescript"],u=a.getModel();if(!u||!n.includes(v(x))||S.autoClosingBrackets==="never")return;let E=g=>["area","base","br","col","command","embed","hr","img","input","keygen","link","meta","param","source","track","wbr","circle","ellipse","line","path","polygon","polyline","rect","stop","use"].includes(g);if(e.browserEvent.key===">"){let g=a.getSelections()||[],p=[],h=[];for(let y of g){h.push(new r.Selection(y.selectionStartLineNumber,y.selectionStartColumn+1,y.endLineNumber,y.endColumn+1));let M=u.getValueInRange({startLineNumber:1,startColumn:1,endLineNumber:y.endLineNumber,endColumn:y.endColumn}).match(/<([\w-]+)(?![^>]*\/>)[^>]*$/);if(!M)continue;let[k,I]=M;E(I)||k.trim().endsWith("/")||p.push({range:{startLineNumber:y.endLineNumber,startColumn:y.endColumn+1,endLineNumber:y.endLineNumber,endColumn:y.endColumn+1},text:`</${I}>`})}setTimeout(()=>{a.executeEdits(u.getValue(),p,h)},0)}};return a.onKeyDown(Oe),de||(()=>{let e=new Map,n={provideHover(u,E){let g=u.getLineContent(E.lineNumber),p=ie(g)[0];if(!p||p.startsWith("https://")||p.startsWith("http://")||p.startsWith(".")||p.startsWith("data:")||p.startsWith("blob:"))return;/^(skypack|unpkg|jsdelivr|esm|esm\.run|esm\.sh|bundle\.run)\:/.test(p)&&(p=p.replace(/^(skypack|unpkg|jsdelivr|esm|esm\.run|esm\.sh|bundle\.run)\:/,""));let h=p.split("/"),y=h[0].startsWith("@")?2:1;return p=h.slice(0,y).join("/"),(async()=>{let w;if(e.has(p))w=e.get(p);else{if(w=await me.getPkgInfo(p),"error"in w)return;e.set(p,w)}if(!w||"error"in w)return;let{name:M,version:k="",description:I="",repo:Q=""}=w;return{contents:[{value:`## [${M}](https://www.npmjs.com/package/${M}/v/${k}) (v${k})
${I}


${Q?`[GitHub](${Q})  |`:""}  [Skypack](https://skypack.dev/view/${M})  |  [jsDelivr](https://www.jsdelivr.com/package/npm/${M}?version=${k})  |  [Unpkg](https://unpkg.com/browse/${M}@${k}/)  | [Openbase](https://openbase.com/js/${M})

Docs: [Importing modules](${new URL("/livecodes/docs/",location.href).href}features/module-resolution)`}]}})()}};r.languages.registerHoverProvider("javascript",n),r.languages.registerHoverProvider("typescript",n),r.languages.registerHoverProvider("html",n)})(),de=!0,{getValue:Te,setValue:Se,getLanguage:we,setLanguage:He,getEditorId:Me,focus:ve,getPosition:De,setPosition:We,layout:qe,addTypes:ke,changeSettings:$e,onContentChanged:je,keyCodes:Ce,addKeyBinding:Ue,registerFormatter:Ie,format:Ae,isReadonly:c,setTheme:Be,undo:Pe,redo:Re,destroy:Ne,monaco:a}};export{kt as createEditor};
