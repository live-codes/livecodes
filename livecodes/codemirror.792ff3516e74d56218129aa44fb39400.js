import{autocompletion as wt}from"@codemirror/autocomplete";import{basicSetup as kt,closeBrackets as Ke,lineNumbers as J}from"codemirror";import{Compartment as j,EditorState as Z}from"@codemirror/state";import{oneDark as Ht}from"@codemirror/theme-one-dark";import{EditorView as w,keymap as Q}from"@codemirror/view";import{redo as vt,undo as qt}from"@codemirror/commands";import{HighlightStyle as Ut,defaultHighlightStyle as Ct,foldEffect as Je,indentUnit as Bt,syntaxHighlighting as Ze}from"@codemirror/language";import{tags as At}from"@lezer/highlight";import{indentationMarkers as It}from"@replit/codemirror-indentation-markers";import{vscodeKeymap as Nt}from"@replit/codemirror-vscode-keymap";import{colorPicker as Rt}from"@replit/codemirror-css-color-picker";var He=()=>document.querySelector("#editor-mode");var ve=(t,r)=>{let a;return(...m)=>{a&&clearTimeout(a),a=setTimeout(()=>t.apply(null,m),typeof r=="function"?r():r)}};var gt=()=>navigator.userAgent.includes("Mac")||navigator.platform.includes("Mac"),qe=t=>gt()?t.metaKey:t.ctrlKey;var Ue=()=>String(Math.random())+"-"+Date.now().toFixed();var Be=["esm.sh","skypack","esm.run","jsdelivr.esm","fastly.jsdelivr.esm","gcore.jsdelivr.esm","testingcf.jsdelivr.esm","jsdelivr.b-cdn.esm","jspm"],Ae=["jsdelivr","fastly.jsdelivr","unpkg","gcore.jsdelivr","testingcf.jsdelivr","jsdelivr.b-cdn","npmcdn"],Ie=["jsdelivr.gh","fastly.jsdelivr.gh","statically","gcore.jsdelivr.gh","testingcf.jsdelivr.gh","jsdelivr.b-cdn.gh"],S={getModuleUrl:(t,{isModule:r=!0,defaultCDN:a="esm.sh",external:m}={})=>{t=t.replace(/#nobundle/g,"");let h=u=>!m||!u.includes("https://esm.sh")?u:u.includes("?")?`${u}&external=${m}`:`${u}?external=${m}`,T=Ce(t,r,a);return T?h(T):r?h("https://esm.sh/"+t):"https://cdn.jsdelivr.net/npm/"+t},getUrl:(t,r)=>t.startsWith("http")||t.startsWith("data:")?t:Ce(t,!1,r||xt())||t,cdnLists:{npm:Ae,module:Be,gh:Ie},checkCDNs:async(t,r)=>{let a=[r,...S.cdnLists.npm].filter(Boolean);for(let m of a)try{if((await fetch(S.getUrl(t,m),{method:"HEAD"})).ok)return m}catch{}return S.cdnLists.npm[0]}},xt=()=>{if(globalThis.appCDN)return globalThis.appCDN;try{return new URL(location.href).searchParams.get("appCDN")||S.cdnLists.npm[0]}catch{return S.cdnLists.npm[0]}},Ce=(t,r,a)=>{let m=r&&t.startsWith("unpkg:")?"?module":"";t.startsWith("gh:")?t=t.replace("gh",Ie[0]):t.includes(":")||(t=(a||(r?Be[0]:Ae[0]))+":"+t);for(let h of ht){let[T,u]=h;if(T.test(t))return t.replace(T,u)+m}return null},ht=[[/^(esm\.sh:)(.+)/i,"https://esm.sh/$2"],[/^(npm:)(.+)/i,"https://esm.sh/$2"],[/^(node:)(.+)/i,"https://esm.sh/$2"],[/^(jsr:)(.+)/i,"https://esm.sh/jsr/$2"],[/^(pr:)(.+)/i,"https://esm.sh/pr/$2"],[/^(pkg\.pr\.new:)(.+)/i,"https://esm.sh/pkg.pr.new/$2"],[/^(skypack:)(.+)/i,"https://cdn.skypack.dev/$2"],[/^(jsdelivr:)(.+)/i,"https://cdn.jsdelivr.net/npm/$2"],[/^(fastly\.jsdelivr:)(.+)/i,"https://fastly.jsdelivr.net/npm/$2"],[/^(gcore\.jsdelivr:)(.+)/i,"https://gcore.jsdelivr.net/npm/$2"],[/^(testingcf\.jsdelivr:)(.+)/i,"https://testingcf.jsdelivr.net/npm/$2"],[/^(jsdelivr\.b-cdn:)(.+)/i,"https://jsdelivr.b-cdn.net/npm/$2"],[/^(jsdelivr\.gh:)(.+)/i,"https://cdn.jsdelivr.net/gh/$2"],[/^(fastly\.jsdelivr\.gh:)(.+)/i,"https://fastly.jsdelivr.net/gh/$2"],[/^(gcore\.jsdelivr\.gh:)(.+)/i,"https://gcore.jsdelivr.net/gh/$2"],[/^(testingcf\.jsdelivr\.gh:)(.+)/i,"https://testingcf.jsdelivr.net/gh/$2"],[/^(jsdelivr\.b-cdn\.gh:)(.+)/i,"https://jsdelivr.b-cdn.net/gh/$2"],[/^(statically:)(.+)/i,"https://cdn.statically.io/gh/$2"],[/^(esm\.run:)(.+)/i,"https://esm.run/$2"],[/^(jsdelivr\.esm:)(.+)/i,"https://cdn.jsdelivr.net/npm/$2/+esm"],[/^(fastly\.jsdelivr\.esm:)(.+)/i,"https://fastly.jsdelivr.net/npm/$2/+esm"],[/^(gcore\.jsdelivr\.esm:)(.+)/i,"https://gcore.jsdelivr.net/npm/$2/+esm"],[/^(testingcf\.jsdelivr\.esm:)(.+)/i,"https://testingcf.jsdelivr.net/npm/$2/+esm"],[/^(jsdelivr\.b-cdn\.esm:)(.+)/i,"https://jsdelivr.b-cdn.net/npm/$2/+esm"],[/^(jspm:)(.+)/i,"https://jspm.dev/$2"],[/^(esbuild:)(.+)/i,"https://esbuild.vercel.app/$2"],[/^(bundle\.run:)(.+)/i,"https://bundle.run/$2"],[/^(unpkg:)(.+)/i,"https://unpkg.com/$2"],[/^(npmcdn:)(.+)/i,"https://npmcdn.com/$2"],[/^(bundlejs:)(.+)/i,"https://deno.bundlejs.com/?file&q=$2"],[/^(bundle:)(.+)/i,"https://deno.bundlejs.com/?file&q=$2"],[/^(deno:)(.+)/i,"https://deno.bundlejs.com/?file&q=https://deno.land/x/$2/mod.ts"],[/^(https:\/\/deno\.land\/.+)/i,"https://deno.bundlejs.com/?file&q=$1"],[/^(github:|https:\/\/github\.com\/)(.[^\/]+?)\/(.[^\/]+?)\/(?!releases\/)(?:(?:blob|raw)\/)?(.+?\/.+)/i,"https://deno.bundlejs.com/?file&q=https://cdn.jsdelivr.net/gh/$2/$3@$4"],[/^(gist\.github:)(.+?\/[0-9a-f]+\/raw\/(?:[0-9a-f]+\/)?.+)$/i,"https://gist.githack.com/$2"],[/^(gitlab:|https:\/\/gitlab\.com\/)([^\/]+.*\/[^\/]+)\/(?:raw|blob)\/(.+?)(?:\?.*)?$/i,"https://deno.bundlejs.com/?file&q=https://gl.githack.com/$2/raw/$3"],[/^(bitbucket:|https:\/\/bitbucket\.org\/)([^\/]+\/[^\/]+)\/(?:raw|src)\/(.+?)(?:\?.*)?$/i,"https://deno.bundlejs.com/?file&q=https://bb.githack.com/$2/raw/$3"],[/^(bitbucket:)snippets\/([^\/]+\/[^\/]+)\/revisions\/([^\/\#\?]+)(?:\?[^#]*)?(?:\#file-(.+?))$/i,"https://bb.githack.com/!api/2.0/snippets/$2/$3/files/$4"],[/^(bitbucket:)snippets\/([^\/]+\/[^\/\#\?]+)(?:\?[^#]*)?(?:\#file-(.+?))$/i,"https://bb.githack.com/!api/2.0/snippets/$2/HEAD/files/$3"],[/^(bitbucket:)\!api\/2.0\/snippets\/([^\/]+\/[^\/]+\/[^\/]+)\/files\/(.+?)(?:\?.*)?$/i,"https://bb.githack.com/!api/2.0/snippets/$2/files/$3"],[/^(api\.bitbucket:)2.0\/snippets\/([^\/]+\/[^\/]+\/[^\/]+)\/files\/(.+?)(?:\?.*)?$/i,"https://bb.githack.com/!api/2.0/snippets/$2/files/$3"],[/^(rawgit:)(.+?\/[0-9a-f]+\/raw\/(?:[0-9a-f]+\/)?.+)$/i,"https://gist.githack.com/$2"],[/^(rawgit:|https:\/\/raw\.githubusercontent\.com)(\/[^\/]+\/[^\/]+|[0-9A-Za-z-]+\/[0-9a-f]+\/raw)\/(.+)/i,"https://deno.bundlejs.com/?file&q=https://raw.githack.com/$2/$3"]];var{getUrl:y,getModuleUrl:Kt}=S,v=y("@live-codes/browser-compilers@0.22.6/dist/");var Ne=y("cm6-theme-basic-light@0.2.0/dist/index.js"),Re=y("cm6-theme-basic-dark@0.2.0/dist/index.js"),De=y("cm6-theme-gruvbox-light@0.2.0/dist/index.js"),Pe=y("cm6-theme-gruvbox-dark@0.2.0/dist/index.js"),$e=y("cm6-theme-material-dark@0.2.0/dist/index.js"),Fe=y("cm6-theme-nord@0.2.0/dist/index.js"),Oe=y("cm6-theme-solarized-light@0.2.0/dist/index.js"),We=y("cm6-theme-solarized-dark@0.2.0/dist/index.js");var L=y("@live-codes/codemirror@0.3.4/build/");var ze=y("comlink@4.4.1/dist/");var M=y("@ddietr/codemirror-themes@1.4.2/dist/theme/");var g=y("thememirror@2.0.1/dist/themes/");var yt=t=>{let r=t.trim(),a,m;return t.includes(":")&&([a,r]=r.split(":"),a!=="monaco"&&a!=="codemirror"&&a!=="codejar"&&(a=void 0)),t.includes("@")&&([r,m]=r.split("@"),m!=="light"&&m!=="dark"&&(m=void 0)),{editor:a,editorTheme:r,theme:m}},Ve=({editor:t,editorTheme:r,theme:a,editorThemes:m})=>{if(!r)return null;let T=(typeof r=="string"?r.split(",").map(u=>u.trim()):r).map(yt);for(let u of T)if((u.editor===t||u.editor===void 0)&&(u.theme===a||u.theme===void 0)&&m.includes(u.editorTheme))return u.editorTheme;return null};import{EditorView as ft}from"@codemirror/view";import{HighlightStyle as Tt,syntaxHighlighting as bt}from"@codemirror/language";var G=[{name:"amy",title:"Amy",url:g+"amy.js",exportName:"amy"},{name:"aura",title:"Aura",url:M+"aura.js",exportName:"aura"},{name:"ayu-light",title:"Ayu Light",url:g+"ayu-light.js",exportName:"ayuLight"},{name:"barf",title:"Barf",url:g+"barf.js",exportName:"barf"},{name:"basic-light",title:"Basic Light",url:Ne,exportName:"basicLight"},{name:"basic-dark",title:"Basic Dark",url:Re,exportName:"basicDark"},{name:"bespin",title:"Bespin",url:g+"bespin.js",exportName:"bespin"},{name:"birds-of-paradise",title:"Birds of Paradise",url:g+"birds-of-paradise.js",exportName:"birdsOfParadise"},{name:"boys-and-girls",title:"Boys and Girls",url:g+"boys-and-girls.js",exportName:"boysAndGirls"},{name:"catppuccin-latte",title:"Catppuccin Latte",url:v+"catppuccin/codemirror/codemirror-theme-catppuccin.js",exportName:"catppuccinLatte"},{name:"catppuccin-frappe",title:"Catppuccin Frappe",url:v+"catppuccin/codemirror/codemirror-theme-catppuccin.js",exportName:"catppuccinFrappe"},{name:"catppuccin-macchiato",title:"Catppuccin Macchiato",url:v+"catppuccin/codemirror/codemirror-theme-catppuccin.js",exportName:"catppuccinMacchiato"},{name:"catppuccin-mocha",title:"Catppuccin Mocha",url:v+"catppuccin/codemirror/codemirror-theme-catppuccin.js",exportName:"catppuccinMocha"},{name:"clouds",title:"Clouds",url:g+"clouds.js",exportName:"clouds"},{name:"cobalt",title:"Cobalt",url:g+"cobalt.js",exportName:"cobalt"},{name:"cm-light",title:"Codemirror Light"},{name:"cool-glow",title:"Cool Glow",url:g+"cool-glow.js",exportName:"coolGlow"},{name:"dracula",title:"Dracula",url:g+"dracula.js",exportName:"dracula"},{name:"espresso",title:"Espresso",url:g+"espresso.js",exportName:"espresso"},{name:"github-dark",title:"GitHub Dark",url:M+"github-dark.js",exportName:"githubDark"},{name:"github-light",title:"GitHub Light",url:M+"github-light.js",exportName:"githubLight"},{name:"gruvbox-dark",title:"Gruvbox Dark",url:Pe,exportName:"gruvboxDark"},{name:"gruvbox-light",title:"Gruvbox Light",url:De,exportName:"gruvboxLight"},{name:"material-dark",title:"Material Dark",url:$e,exportName:"materialDark"},{name:"material-light",title:"Material Light",url:M+"material-light.js",exportName:"materialLight"},{name:"monochrome",title:"Monochrome"},{name:"monochrome-dark",title:"Monochrome Dark"},{name:"noctis-lilac",title:"Noctis Lilac",url:g+"noctis-lilac.js",exportName:"noctisLilac"},{name:"nord",title:"Nord",url:Fe,exportName:"nord"},{name:"one-dark",title:"One Dark"},{name:"rose-pine-dawn",title:"Ros\xE9 Pine Dawn",url:g+"rose-pine-dawn.js",exportName:"rosePineDawn"},{name:"smoothy",title:"Smoothy",url:g+"smoothy.js",exportName:"smoothy"},{name:"solarized-dark",title:"Solarized Dark",url:We,exportName:"solarizedDark"},{name:"solarized-light",title:"Solarized Light",url:Oe,exportName:"solarizedLight"},{name:"tokyo-night",title:"Tokyo Night",url:M+"tokyo-night.js",exportName:"tokyoNight"},{name:"tokyo-night-day",title:"Tokyo Night Day",url:M+"tokyo-night-day.js",exportName:"tokyoNightDay"},{name:"tokyo-night-storm",title:"Tokyo Night Storm",url:M+"tokyo-night-storm.js",exportName:"tokyoNightStorm"},{name:"tomorrow",title:"Tomorrow",url:g+"tomorrow.js",exportName:"tomorrow"}],_e=({variant:t,settings:r,styles:a})=>{let m=ft.theme({"&":{backgroundColor:r.background,color:r.foreground},".cm-content":{caretColor:r.caret},".cm-cursor, .cm-dropCursor":{borderLeftColor:r.caret},"&.cm-focused .cm-selectionBackgroundm .cm-selectionBackground, .cm-selectionMatch, .cm-content ::selection":{backgroundColor:r.selection},".cm-activeLine":{backgroundColor:r.lineHighlight},".cm-gutters":{backgroundColor:r.gutterBackground,color:r.gutterForeground},".cm-activeLineGutter":{backgroundColor:r.lineHighlight}},{dark:t==="dark"}),h=Tt.define(a);return[m,bt(h)]},Ge={monochrome:_e({variant:"light",settings:{background:"#fffffe",foreground:"#24292e",caret:"#24292e",selection:"#c8c8fa",gutterBackground:"#fffffe",gutterForeground:"#24292e",lineHighlight:"#f1faff"},styles:[]}),"monochrome-dark":_e({variant:"dark",settings:{background:"#24292e",foreground:"#e2e2e3",caret:"#e2e2e3",selection:"#444d56",gutterBackground:"#24292e",gutterForeground:"#e2e2e3",lineHighlight:"#444d56"},styles:[]})};import{LanguageSupport as Et,StreamLanguage as Lt}from"@codemirror/language";import{html as Mt}from"@codemirror/lang-html";import{css as St}from"@codemirror/lang-css";import{javascript as I}from"@codemirror/lang-javascript";import{json as jt}from"@codemirror/lang-json";var x=t=>new Et(Lt.define(t)),c=t=>L+t,i={vue:c("codemirror-lang-vue.js"),svelte:c("codemirror-lang-svelte.js"),liquid:c("codemirror-lang-liquid.js"),json:c("codemirror-lang-json.js"),markdown:c("codemirror-lang-markdown.js"),python:c("codemirror-lang-python.js"),php:c("codemirror-lang-php.js"),java:c("codemirror-lang-java.js"),clike:c("codemirror-lang-clike.js"),mllike:c("codemirror-lang-mllike.js"),cpp:c("codemirror-lang-cpp.js"),sql:c("codemirror-lang-sql.js"),wast:c("codemirror-lang-wast.js"),scss:c("codemirror-lang-scss.js"),minizinc:c("codemirror-lang-minizinc.js"),prolog:c("codemirror-lang-prolog.js"),coffeescript:c("codemirror-lang-coffeescript.js"),livescript:c("codemirror-lang-livescript.js"),ruby:c("codemirror-lang-ruby.js"),go:c("codemirror-lang-go.js"),perl:c("codemirror-lang-perl.js"),lua:c("codemirror-lang-lua.js"),r:c("codemirror-lang-r.js"),julia:c("codemirror-lang-julia.js"),scheme:c("codemirror-lang-scheme.js"),clojure:c("codemirror-lang-clojure.js"),tcl:c("codemirror-lang-tcl.js"),less:c("codemirror-lang-less.js"),stylus:c("codemirror-lang-stylus.js"),rust:c("codemirror-lang-rust.js"),swift:c("codemirror-lang-swift.js")},K={html:async()=>Mt(),css:async()=>St(),javascript:async()=>I(),typescript:async()=>I({typescript:!0}),jsx:async()=>I({jsx:!0}),tsx:async()=>I({jsx:!0,typescript:!0}),json:async()=>jt(),vue:async()=>(await import(i.vue)).vue(),svelte:async()=>(await import(i.svelte)).svelte(),liquid:async()=>(await import(i.liquid)).liquid(),markdown:async()=>(await import(i.markdown)).markdown(),python:async()=>(await import(i.python)).python(),php:async()=>(await import(i.php)).php(),go:async()=>(await import(i.go)).go(),java:async()=>(await import(i.java)).java(),cpp:async()=>(await import(i.cpp)).cpp(),sql:async()=>(await import(i.sql)).sql(),wat:async()=>(await import(i.wast)).wast(),scss:async()=>(await import(i.scss)).sass(),sass:async()=>(await import(i.scss)).sass({indented:!0}),minizinc:async()=>(await import(i.minizinc)).MiniZinc(),prolog:async()=>(await import(i.prolog)).prolog(),coffeescript:async()=>x((await import(i.coffeescript)).coffeeScript),livescript:async()=>x((await import(i.livescript)).liveScript),ruby:async()=>x((await import(i.ruby)).ruby),perl:async()=>x((await import(i.perl)).perl),lua:async()=>x((await import(i.lua)).lua),r:async()=>x((await import(i.r)).r),julia:async()=>x((await import(i.julia)).julia),scheme:async()=>x((await import(i.scheme)).scheme),clojure:async()=>x((await import(i.clojure)).clojure),tcl:async()=>x((await import(i.tcl)).tcl),less:async()=>x((await import(i.less)).less),stylus:async()=>x((await import(i.stylus)).stylus),csharp:async()=>x((await import(i.clike)).csharp),ocaml:async()=>x((await import(i.mllike)).oCaml),rust:async()=>x((await import(i.rust)).rust),swift:async()=>x((await import(i.swift)).swift)};var X,N=!1,Dt=ve(()=>N=!N,50),wo=async t=>{let{container:r,readonly:a,isEmbed:m,editorId:h,getFormatterConfig:T,getFontFamily:u,getLanguageExtension:Qe}=t,d={...t};if(!r)throw new Error("editor container not found");let Y=async e=>K[e]?.()||K.html?.(),ee=e=>e.startsWith("vue")?"vue":e.startsWith("svelte")?"svelte":e==="liquid"?"liquid":t.mapLanguage?.(e)||e,q={"one-dark":Ht,"cm-light":[Ze(Ct),w.theme({"&":{backgroundColor:"#ffffff"}})],...Ge},te={dark:"one-dark",light:"cm-light"},oe=()=>q[re]||q[te[t.theme]]||[],k=t.language,b=ee(k),R=await Y(b),re=await Me(t.theme,t.editorTheme),U=[],D=[],Xe=e=>{e.docChanged&&D.forEach(o=>o(e))},E,P,$,F,O,ne=e=>b==="typescript"?e:b==="javascript"?e.slice(0,-1):[],se,ce=new Promise(e=>se=e),ie=async(e=!1)=>{let o=E&&e?"changeCodeMirrorLanguage":"initCodeMirrorTS";if(e&&(E=void 0),!["typescript","javascript"].includes(b)||E)return;let n=`${L}codemirror-ts.js`,[l,p,f]=await Promise.all([import(n),import(ze+"esm/comlink.min.js"),window.compiler.typescriptFeatures({feature:o,payload:k})]),{tsFacetWorker:H,tsSyncWorker:C,tsLinterWorker:B,tsAutocompleteWorker:at,tsHoverWorker:mt}=l;if(!X){let we=document.querySelector("#compiler-frame");if(!we?.contentWindow)return;let ke=p.wrap(p.windowEndpoint(we.contentWindow));await ke.initialize(),X=ke}let pt=Ue(),A=Qe(k),ut=b==="typescript"&&!A?.endsWith("ts")&&!A?.endsWith("tsx")?A+".tsx":A,dt=`/${h}.${pt}.${ut}`;E=E||[H.of({worker:X,path:dt}),C(),wt({override:[at()]}),mt(),B()],s.dispatch({effects:[me.reconfigure(ne(E))]})},Ye=e=>{ce.then(()=>{window.compiler.typescriptFeatures({feature:"addTypes",payload:e})})},le=async e=>{let o={vim:`${L}codemirror-vim.js`,emacs:`${L}codemirror-emacs.js`,emmet:`${L}codemirror-emmet.js`,lineNumbersRelative:`${L}codemirror-line-numbers-relative.js`},[n,l,p,f]=await Promise.all([e.editorMode==="vim"?import(o.vim):Promise.resolve({}),e.editorMode==="emacs"?import(o.emacs):Promise.resolve({}),e.emmet?import(o.emmet):Promise.resolve({}),e.lineNumbers==="relative"?import(o.lineNumbersRelative):Promise.resolve({})]);P=n.vim,$=l.emacs,F=p.emmet,O=f.lineNumbersRelative};await le(t);let ae=new j,me=new j,pe=new j,ue=new j,W=w.editable.of(!1),de=new j,et=new j,ge=new j,tt=Ut.define([{tag:At.comment,fontStyle:"italic"}]),xe=e=>{let o=(e.fontSize??d.fontSize)||(m?12:14),n=u(e.fontFamily??d.fontFamily),l=e.tabSize??d.tabSize,p=e.useTabs??d.useTabs,f=e.wordWrap??d.wordWrap,H=e.emmet??d.emmet,C=e.lineNumbers??d.lineNumbers,B=e.editorMode??d.editorMode;return[Z.tabSize.of(l),Bt.of(p?"	":" ".repeat(l)),...f?[w.lineWrapping]:[],...B==="vim"&&P?[P()]:B==="emacs"&&$?[$()]:[],...H&&F?[F]:[],...C==="relative"&&O?[O()]:C&&J?[J()]:[],w.theme({"&":{height:"100%",fontSize:o+"px"},".cm-scroller":{overflow:"auto",fontFamily:n}})]},he=()=>{let e=[ae.of(R),me.of(["typescript","javascript"].includes(b)&&E?ne(E):[]),w.updateListener.of(Xe),ue.of(oe()),Ze(tt),de.of(xe({})),pe.of(Q.of(U)),ge.of(d.closeBrackets?Ke():[]),kt,a?W:[],Q.of(Nt),It(),Rt],o=[W,...e],n=[W,...e],l=[...e];return h==="console"?l:h==="compiled"?n:t.mode==="codeblock"?o:e},ye=async e=>{let o=He(),n=l=>{o&&(o.textContent=l)};e||n(""),e==="vim"&&n("Vim"),e==="emacs"&&n("Emacs")},s=new w({state:Z.create({extensions:he(),doc:t.value}),parent:r});ye(t.editorMode);let ot=()=>h,fe=()=>s.state.doc.toString(),z=(e="",o=!0)=>{o?s.setState(Z.create({doc:e,extensions:he()})):s.dispatch({changes:{from:0,to:s.state.doc.length,insert:e}})},Te=()=>s.focus(),rt=()=>k,nt=(e,o)=>{k=e,b=ee(k),Y(b).then(n=>{R=n,s.dispatch({effects:[ae.reconfigure(R)]})}),ce.then(()=>{ie(!0)}),o!=null&&z(o)};ie().then(()=>{se()});let st=e=>{D.push(e)},be={CtrlEnter:"Ctrl-Enter",ShiftEnter:"Shift-Enter",Enter:"Enter",UpArrow:"ArrowUp",DownArrow:"ArrowDown",ShiftAltF:"Shift-Alt-f"},V=(e,o,n)=>{U.push({key:o,run(){return n(),!0}}),s.dispatch({effects:pe.reconfigure(Q.of(U))})},Ee=e=>{e.code==="KeyM"&&qe(e)&&(e.preventDefault(),Dt(),setTimeout(()=>{s.setTabFocusMode?.(N)},70))};s.setTabFocusMode(N),addEventListener("keydown",Ee);let _,ct=e=>{e&&(_=e,V("format",be.ShiftAltF,async()=>{await Le(),Te()}))},Le=async()=>{if(!_)return;let e=s.state.selection.main.to,o=fe(),n=await _(o,e,T());z(n.formatted,!1);let l=n.cursorOffset>=0?n.cursorOffset:0;s.dispatch({selection:{anchor:l}})};async function Me(e,o){let n=Ve({editor:"codemirror",editorTheme:o,theme:e,editorThemes:G.map(f=>f.name)}),l=n||te[e],p=G.find(f=>f.name===l);if(!q[l]&&p?.url){let f=(await import(p.url))[p.exportName||"default"];q[l]=f}return l}let Se=(e,o)=>{Me(e,o).then(n=>{re=n,s.dispatch({effects:ue.reconfigure(oe())})})},it=e=>{d={...e},le(d).then(()=>{s.dispatch({effects:[de.reconfigure(xe(d)),et.reconfigure(d.lineNumbers?J():[]),ge.reconfigure(d.closeBrackets?Ke():[])]}),Se(d.theme,d.editorTheme),ye(d.editorMode)})},lt=()=>{qt({state:s.state,dispatch:s.dispatch})},je=()=>{vt({state:s.state,dispatch:s.dispatch})};return V("redo","Mod-Shift-z",je),{getValue:fe,setValue:z,getLanguage:rt,setLanguage:nt,getEditorId:ot,focus:Te,getPosition:()=>{let e=s.state.selection.asSingle().ranges[0].from,o=s.state.doc.lineAt(e),n=o.number,l=e-o.from+1;return{lineNumber:n,column:l}},setPosition:({lineNumber:e,column:o=1})=>{let n=o-1,l=s.state.doc.lines>e?e:s.state.doc.lines,p=s.state.doc.line(l),f=p.length>n?n:p.length,H=p.from+f;s.dispatch({selection:{anchor:H},effects:[w.scrollIntoView(H,{x:"center",y:"center"})]})},foldRegions:()=>{let e=s.state.doc.toString(),o=/\/\/#region[\s\S]*?\/\/#endregion/g,n;for(;(n=o.exec(e))!==null;){let l=n.index+e.slice(n.index).indexOf(`
`),p=n.index+n[0].length;s.dispatch({effects:Je.of({from:l,to:p})})}},foldLines:e=>{e.forEach(o=>{let n=0,l=s.state.doc.length;if(!(o.from<0||o.to<0||o.from>o.to))try{if(o.from&&(n=s.state.doc.line(o.from).from),o.to){let p=s.state.doc.line(o.to);l=p.from+p.length}s.dispatch({effects:Je.of({from:n,to:l})})}catch{}})},addTypes:Ye,onContentChanged:st,keyCodes:be,addKeyBinding:V,changeSettings:it,registerFormatter:ct,format:Le,isReadonly:a,setTheme:Se,undo:lt,redo:je,destroy:()=>{D.length=0,U.length=0,s.destroy(),r.innerHTML="",removeEventListener("keydown",Ee)},codemirror:s}};export{wo as createEditor};
